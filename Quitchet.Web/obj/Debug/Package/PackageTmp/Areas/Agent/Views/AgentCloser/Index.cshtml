@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout_Customer.cshtml";
}
<link href="~/AgentStyles/Select-Styles-JS/bootstrap-select.min.css" rel="stylesheet" />
<script src="~/AgentStyles/Select-Styles-JS/bootstrap-select.min.js"></script>
<link href="~/AgentStyles/AgentStyles.css" rel="stylesheet" />
<style>
    select.bs-select-hidden, select.selectpicker {
        display: block !important;
    }

    .closerheader2 {
        background-color: #ff5d26;
        color: #fff;
        text-align: center;
        font-size: 18px;
        padding: 5px;
    }

    .tabimages {
        margin-right: 20px;
        margin-bottom:0;
    }

    #exTab3 .nav-pills > li > a {
        padding: 6px 150px;
    }

    .grayheaders {
        background-color: #646464;
        color: #fff;
        font-size: 16px;
        padding: 10px;
        padding-left: 30px;
    }

    .photos {
        height: 60px;
        width: 60px;
        border-radius: 50px;
        margin-bottom: 0;
    }

    .photos2 {
        height: 50px;
        width: 50px;
        border-radius: 50px;
        margin-bottom: 0;
    }


    .fa-search {
        color: gray;
    }
    /****** jQuery Autocomplete CSS *************/
    .ui-autocomplete-input {
        z-index: 5000 !important;
    }


    .ui-menu {
        border: 1px solid lightgray;
        font-family: 'Inder', sans-serif;
        font-size: 15px;
        width: 54px;
    }

        .ui-menu .ui-menu-item a {
            color: gray;
        }

        .ui-menu .ui-menu-item:hover {
            display: block;
            text-decoration: none;
            color: #fff;
            cursor: pointer;
            background-color: #ff5d26;
            border: 1px solid lightgray;
        }

    .ui-autocomplete {
        position: absolute;
    }

    /****** jQuery Autocomplete CSS END*************/
    .bootstrap-select:not([class*=col-]):not([class*=form-control]):not(.input-group-btn) {
        width: 135px;
    }

    .btn {
        padding: 3px;
    }

    .greentail {
        width: 0px;
        height: 0px;
        border: 7px solid;
        border-color: transparent #43B75A transparent transparent;
        position: absolute;
        left: -13px;
        top: 6px;
    }

    .orangetail {
        width: 0px;
        height: 0px;
        border: 7px solid;
        border-color: transparent #FF7926 transparent transparent;
        position: absolute;
        left: -13px;
        top: 6px;
    }
    inner-addon {
        position: relative;
    }

    /* style glyph */
    .inner-addon .glyphicon {
        position: absolute;
        padding: 6px;
        color: gray;
        pointer-events: none;
    }

    /* align glyph */
    .right-addon .glyphicon {
        right: 0px;
    }

    /* add padding  */
    .right-addon input {
        padding-right: 30px;
    }

    .btn-group .mypopupbtncls {
        width: 50% !important;
    }
    .ui-autocomplete {
    z-index: 1051 !important;
}
    .footer {
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    background-color: red;
    color: white;
    text-align: center;
}

    .sellerbuyer_Call{
        margin-bottom:0;
    }
    .sellerbuyer_Chat{
        margin-bottom:0;
    }
      .prptextlimit{
            height: 1.1em;
    line-height: 1.1;
    width:90px;
        }
</style>
@*Header DIv*@
<div id="horizontalbor" class="col-sm-12" style="padding:3px">
    <div class="col-sm-4" style="padding:4px">
        <a href="/Agent/MyQuitchet/Index" id="backBtn" class="btn btn-default btn-sm" style="padding:5px 20px;border:none;background-color:#ff5d26;color:#fff">Back</a>
    </div>
    <div class="col-sm-4 headerintop" style="text-align:center"><img src="/img/closer.png" alt="" style="height:31px;width:31px;margin-right: 20px;margin-bottom:0">Closer</div>
    <div class="col-sm-4" style="text-align:right;margin-top:5px">
        <a href="#" id="editClosings" class="btn btn-default btn-sm" style="display:none;padding:5px 20px;border:none;background-color:#ff5d26;color:#fff">Edit</a>
    </div>
</div>
@*Tabbed Menu*@
<div id="tabmenu">
    <div class="col-sm-12 closerheader2">
        Your Closing Properties
    </div>
    <div class="col-sm-12" id="exTab3" style="border-bottom: none;">
        <ul class="nav nav-pills">
            <li class="active">
                <a href="#buying_tab" id="buying_tab_a" data-toggle="tab" onclick="getBuyingListings()"><img class="tabimages" src="~/img/buyer_tabicon.png" />Buying</a>
            </li>
            <li>
                <a href="#selling_tab" id="selling_tab_a" data-toggle="tab" onclick="getSellingListings()"><img class="tabimages" src="~/img/SellerTab_icon.png" style="height: 40px;"/>Selling</a>
            </li>
        </ul>
    </div>
    @*Div Elements for Tabs*@
    <div class="tab-content clearfix">
        <div class="tab-pane active" id="buying_tab" style="">
            <div class="col-sm-12 " style="padding:0" id="buyings_div">
                <div class="col-sm-12 scrolls_divs" id="buyinglistings_div" style="background-color:#fff;padding:0;max-height:65vh;min-height:68vh;overflow-x:hidden;overflow-y:auto;"></div>
                <div class="col-sm-12 footer" style="text-align:right;background-color:rgb(249, 210, 196);padding:15px;padding-right:50px">
                    <button href="#" data-toggle="modal" data-target="#AddClosingForBuying_Popup" class="btn btn-default btn-lg" style="padding:5px 20px;border:none;background-color:#ff5d26;color:#fff">
                        @*<i class="fa fa-plus" aria-hidden="true" style="margin-right: 10px;"></i>*@
                        <img src="~/img/PlusIcon.png" style="margin-bottom:0;margin-right: 10px;" />Add New Closing
                    </button>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="selling_tab">
            <div class="col-sm-12 " style="padding:0">
                <div class="col-sm-12 scrolls_divs" id="sellinglistings_div" style="padding:0;max-height:65vh;min-height:68vh;overflow-x:hidden;overflow-y:auto;"></div>
                <div class="col-sm-12 footer" style="text-align:right;background-color:rgb(249, 210, 196);padding:15px;padding-right:50px">
                    <button href="#" data-toggle="modal" data-target="#AddClosingForSelling_Popup" class="btn btn-default btn-lg" style="padding:5px 20px;border:none;background-color:#ff5d26;color:#fff">
                        @*<i class="fa fa-plus" aria-hidden="true" style="margin-right: 10px;"></i>*@
                        <img src="~/img/PlusIcon.png" style="margin-bottom:0;margin-right: 10px;" />Add New Closing
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
@*Manage Div*@
<div class="col-sm-12" id="manageDiv" style="padding:0;display:none">
    <div class="col-sm-8 scrolls_divs" style="padding:0px;width:64%;border-right: 1px solid gray;max-height:84.5vh;overflow-x:hidden;overflow-y:auto">
        <div class="col-sm-12 closerheader2" style="padding:7px;text-align:center">
            <div class="col-sm-4">
                <a href="#" id="backBtn2" class="btn btn-default btn-sm" style="padding:3px 22px;background-color:#ff5d26;color:#fff;float:left">Back</a>
            </div>
            <div class="col-sm-4" style="text-align:center">
                Closing Parties
            </div>
            <div class="col-sm-4" style="text-align:right">
                <a href="#" id="" data-target="#CancelClosingConfirmationPopup" data-toggle="modal" class="btn btn-default btn-sm" style="padding:3px 22px;background-color:#ff5d26;color:#fff;">Cancel this Closing</a>
            </div>
        </div>
        <div class="" style="" id="collaps_divs">
            <div class="col-sm-12 grayheaders" id="assignedtomeDiv" data-toggle="collapse" data-target="#assignedtome_Data_Div" style="cursor:pointer;" onclick="BindAssignedMe()">
                Assigned to me:
            </div>
            <div class="col-sm-12 scrolls_divs collapse" id="assignedtome_Data_Div" style="padding:0;max-height:340px;overflow-y:auto;overflow-x:hidden">
            </div>
            <div class="col-sm-12 grayheaders" id="assignedtobuyereDiv" data-toggle="collapse" data-target="#assignedtobuyer_Data_Div" style="border-top:1px solid #FDFDFD;border-bottom:1px solid #FDFDFD;cursor:pointer;" onclick="BindAssignedBuyer()">
                Assigned to buyer:
            </div>
            <div class="col-sm-12 scrolls_divs collapse" id="assignedtobuyer_Data_Div" style="padding:0;max-height:320px;overflow-y:auto;overflow-x:hidden">
            </div>
            <div class="col-sm-12 grayheaders" id="assignedtoagentDiv" data-toggle="collapse" data-target="#assignedtoagent_Data_Div" style="cursor:pointer;" onclick="BindAssignedAgent()">
                Assigned to Listing Agent:
            </div>
            <div class="col-sm-12 scrolls_divs collapse" id="assignedtoagent_Data_Div" style="padding:0;max-height:320px;overflow-y:auto;overflow-x:hidden">
            </div>
        </div>
    </div>
    <div class="col-sm-4" style="padding:0;width:36%">
        <div class="col-sm-12" style="background-color:#99A3A4;color:black;padding:0;height:90px;" id="agentsmaindiv">
            <div class="col-sm-9" style="padding:0;">
                <div class="col-sm-2" style="padding:25px;padding-left:17px">
                    <label id="listingagenttype">Listing Agent</label>
                </div>
                <div class="col-sm-3" style="top:12px;">
                    <img class="photos" id="listingagent_photo" src="~/img/addphotopic.png" />
                </div>
                <div class="col-sm-7" style="height: 90px;top:12px;">
                    <div class="col-sm-12"><label id="listingagent_name" style="font-weight:bold;font-size:15px;">James Clifton</label></div>
                    <div class="col-sm-12"><label class="textlimit" id="listingagent_company" style="font-size:14px;">Kellet winslet Company</label></div>
                    
                </div>
            </div>
            <div class="col-sm-3" id="phonechatdiv" style="box-shadow: 0 3px 5px rgba(0, 0, 0, 1);height:90px;padding-left:0;">
                <div class="col-sm-6" style="top:30px;"><img class="listingagent_Call" src="/img/phone_icon_agnt-1.png" style="cursor:pointer;height:23px;width:25px;" /></div>
                <div class="col-sm-6" style="top:30px;" id="lachatdiv"><img class="listingagent_Chat" src="/img/chat_iconMyAgent_MP.png" style="cursor:pointer;" /></div>
                <span hidden="hidden" id="listingagent_id"></span>
                <span hidden="hidden" id="listingagent_pk_userid"></span>
                <span hidden="hidden" id="listingagent_phone"></span>
                <span hidden="hidden" id="listingagent_mail"></span>
            </div>
        </div>
        <div class="col-sm-12" style="background-color:#fff;color:#fff;padding:5px;height:120px;">
            <div class="col-sm-4" id="closinglist_image" style="background-size: 100% 100%;background-image:url(/img/NoImage.png);background-position:center;background-repeat: no-repeat;height:110px;"></div>
            <div class="col-sm-5" style="">
                <div class="col-sm-12" id="closinglist_price" style="color:#ff5d26;font-weight:bold;font-size:15px">$125,658</div>
                <div class="col-sm-12 textlimit" id="closinglist_addr1" style="font-weight:bold;font-size:15px;color:black">101 Breaburn Drive</div>
                <div class="col-sm-12 textlimit" id="closinglist_addr2" style="color:gray;">Greenville, Sc 123695</div>
                <div class="col-sm-12" id="closinglist_mlsid" style="color:gray;"></div>
            </div>
            <div class="col-sm-3" style="display:none" id="hadseller">
                <div>
                    <div class="col-sm-12" id="customertype" style="background-color:#777474;padding:4px;text-align:center;border-radius:10px 5px 0 0">
                        Seller
                    </div>
                    <div class="col-sm-12" style="background-color:#ff5d26;padding:4px;border-radius:0px 0px 10px 0px;text-align: center;">
                        <img class="sellerbuyer_Call" src="~/img/mbwhite.png" style="cursor:pointer" />&nbsp;
                        <img class="sellerbuyer_Chat" src="~/img/chat_iconMyAgent_MP.png" style="cursor:pointer" />
                        <span hidden="hidden" id="sellerbuyer_id"></span>
                        <span hidden="hidden" id="sellerbuyer_Pkey_userid"></span>
                        <span hidden="hidden" id="sellerbuyer_phone"></span>
                    </div>
                </div>
                <div class="col-sm-12" style="top:9px;color:black;">
                    <div class="col-sm-6" style="padding:0">
                        <img id="sellerbuyer_photo" src="~/img/addphotopic.png" style="margin-left:-40px;border-radius:50px;height:35px;width:35px" />&nbsp;
                    </div>
                    <div class="col-sm-6" style="padding:0;margin-left:-30px">
                        <div style="font-weight:bold" id="sellerbuyer_name" class="prptextlimit">Erin Dean</div>
                    </div>
                </div>
            </div>
            <div class="col-sm-3" style="padding:15px;margin-top:10px;display:none" id="noseller">
                <div data-toggle="modal" data-target="#AddBuyerPopup" style="background-color:#ff5d26;border-radius:4px;font-size:14px;text-align:center;padding:6px; cursor:pointer">
                    Assign the Buyer
                </div>
            </div>
        </div>
    </div>
</div>
@*Shcedule Div*@
<div class="col-sm-12" style="padding:0px;background-color: #fff;" id="ScheduleAndEditDiv">
    <div id="horizontalbor" class="col-sm-12" style="padding:3px;background-color:#646464">
        <div class="col-sm-4" style="padding:4px">
            <a href="#" id="backBtninScheduleDiv" class="btn btn-default btn-sm" style="padding:5px 20px;border:none;background-color:#ff5d26;color:#fff">Back</a>
        </div>
        <div class="col-sm-4 headerintop" style="text-align:center">Closing Parties</div>
        <div class="col-sm-4" style="text-align:right;padding:4px">
        </div>
    </div>
    <div class="col-sm-8" id="schedulediv" style="height:80.5vh;display:none;padding:0;float:left;width:64%;border-right:1px solid gray;background-color:#FDFDFD">
        <div class="col-sm-12" style="background-color:#ff5d26;height:34px;text-align:center;padding:0">
            <span style="color:white; font-size:13px; font-weight:normal;position:relative;top:8px;left:33px" id="shceduleheadertext">Schedule Service</span>
        </div>
        <div class="col-sm-12" style="padding:20px">
            <div class="col-sm-1"></div>
            <div class="col-sm-7" style="padding-left:0px;padding-right:0px">
                <div class="col-sm-2" style="padding-left:0px;padding-right:0px;width:58px!important">
                    <img src="/img/addphotopic.png" id="cp_photo" style="margin-bottom:4px!important;height:50px;width:50px;border-radius:50px;" />
                </div>
                <div class="col-sm-10" style="text-align:left;line-height:16px!important;padding-left: 0px;padding-top: 8px;">
                    <table>
                        <tr>
                            <td>
                                <label id="cp_name" style="font-size:13px;font-weight:bold;padding-bottom:5px;margin:0px 0px 0px 0px">Kent Mitchell</label><br>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span id="cp_company" style="font-size:12px;color:#ff5d26;padding:0px 0px 0px 0px;font-weight:bold">A Better Home Inspections</span><br>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="col-sm-4"></div>
        </div>
        <div class="col-sm-12">
            <div class="col-sm-2" style="padding-right:0">&nbsp;</div>
            <div class="col-sm-6" style="padding-left:0">
                <label style="font-size:11px;color:gray">
                    Enter the data and time you would like the services rendered.
                </label>
            </div>
            <div class="col-sm-4">&nbsp;</div>
        </div>
        <div class="col-sm-12" style="font-size:11px;color:gray;margin-top:10px">
            <div class="col-sm-2" style="padding-right:0">&nbsp;</div>
            <div class="col-sm-6" style="padding-left:0">
                <div class="col-sm-2" style="padding-left:0;padding-right:0;width:24px">
                    Date
                </div>
                <div class="col-sm-5" style="margin-top:-5px">
                    <div class="inner-addon right-addon">
                        <i class="glyphicon glyphicon-calendar" style="right: 14px;"></i>
                        @Html.TextBox("S_Service_Date", "", new { @class = "form-control", style = "cursor-color:#ff5d26;border-color: #ff6937;height: 24px; ", placeholder = "DD/MM/YYYY" })
                    </div>
                </div>
                <div class="col-sm-2" style="padding-right: 0px;width: 42px;">Time</div>
                <div class="col-sm-2" style="padding:0">
                    <input id="S_Service_Time" placeholder="Any" onclick="OpenTimepicker('S_TimePicker', 'S_Service_Time')" type="text" class="form-control" readonly style="border:1px #ff6a00 solid;position:relative;left:5px;width:85px;background-color:white;font-size:11px;height:24px;top:-5px;border-radius:3px" data-toggle="collapse" data-target="#S_TimePicker" />
                    <span class="glyphicon glyphicon-triangle-bottom" style="left:70px;color:black;top:-23px;">
                    </span>
                    <div id="S_TimePicker" class="collapse" style="width:100px; background-color:white; position:absolute; left:5px;top:30px;box-shadow: 4px 16px 8px 0px rgba(0,0,0,0.2);border-radius:5px;padding:0px 0px 0px 0px">
                    </div>
                </div>
            </div>
            <div class="col-sm-4">&nbsp;</div>
        </div>
        <div class="col-sm-12" id="msgdiv">
            <div class="col-sm-1"></div>
            <div class="col-sm-9">
                <label style="font-size:11px;color:#ff5d26;font-weight:bold">Message:</label>
                <br>
                <textarea rows="10" id="msg"  readonly style="white-space: pre-wrap;border-radius:4px;border:0.5px solid #ff5d26;width:100%;margin-top:10px;resize:none;overflow:auto;
                font-size:11px;padding:6px 6px 6px 6px"></textarea>
            </div>
            <div class="col-sm-2"></div>
        </div>
        <div class="col-sm-12">&nbsp;</div>
        <div class="col-sm-12">
            <div class="col-sm-1"></div>
            <div class="col-sm-4" id="attachmentdiv">
                <button type="button" class="btn" data-dismiss="modal" id="AddAtachmentBtn" style="border-radius: 5px;border: 1px solid #ff5d26;padding:5px 40px;background-color: transparent; color: #ff5d26;font-size: 15px;">
                    Attach Document
                </button>
            </div>
            <div class="col-sm-1"></div>
            <div class="col-sm-4">
                <div class="btn-group btn-group-sm" style="width:100%">
                    <button type="button" class="mypopupbtncls btn" data-dismiss="modal" id="CancelSchedule" style="width:40%;border-radius: 5px 0px 0px 5px;border: 1px solid#fff;background-color: gray; color: white;font-size: 15px;">Cancel</button>
                    <button type="button" id="SaveScheduleService" class="mypopupbtncls btn" style="width:40%;border: 1px solid#fff;border-radius: 0px 5px 5px 0px;background-color: #FF6937; color: white;font-size: 15px;">Send</button>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-8" id="editschedulediv" style="height:80.5vh;padding:0;float:left;width:64%;height:84vh;border-right:1px solid gray;background-color:#FDFDFD">
        <div class="col-sm-12" style="background-color:#ff5d26;height:34px;text-align:center;padding:0">
            <span style="color:white; font-size:13px; font-weight:normal;position:relative;top:8px;left:33px">Edit Schedule</span>
        </div>
        <div class="col-sm-12" style="padding:20px">
            <div class="col-sm-1"></div>
            <div class="col-sm-7" style="padding-left:0px;padding-right:0px">
                <div class="col-sm-2" style="padding-left:0px;padding-right:0px;width:58px!important">
                    <img src="/img/addphotopic.png" style="margin-bottom:4px!important;height:50px;width:50px" />
                </div>
                <div class="col-sm-10" style="text-align:left;line-height:16px!important;padding-left: 0px;padding-top: 8px;">
                    <table>
                        <tr>
                            <td>
                                <label id="S_Edit_lblContactName" style="font-size:13px;font-weight:bold;padding-bottom:5px;margin:0px 0px 0px 0px">Kent Mitchell</label><br>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span id="S_Edit_spnContactPhone" style="font-size:12px;color:#ff5d26;padding:0px 0px 0px 0px;font-weight:bold">A Better Home Inspections</span><br>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="col-sm-4"></div>
        </div>
        <div class="col-sm-12">
            <div class="col-sm-2" style="padding-right:0">&nbsp;</div>
            <div class="col-sm-6" style="padding-left:0">
                <label style="font-size:11px;color:gray">
                    Enter the data and time you would like the services rendered.
                </label>
            </div>
            <div class="col-sm-4">&nbsp;</div>
        </div>
        <div class="col-sm-12" style="font-size:11px;color:gray;margin-top:10px">
            <div class="col-sm-2" style="padding-right:0">&nbsp;</div>
            <div class="col-sm-6" style="padding-left:0">
                <div class="col-sm-2" style="padding-left:0;padding-right:0;width:24px">
                    Date
                </div>
                <div class="col-sm-4" style="margin-top:-5px">
                    <div class="inner-addon right-addon">
                        <i class="glyphicon glyphicon-calendar"></i>
                        @Html.TextBox("S_Edit_Service_Date", "", new { @class = "form-control", style = "cursor-color:#ff5d26;border-color: #ff6937;height: 24px; ", placeholder = "Date" })

                    </div>
                </div>
                <div class="col-sm-2" style="padding-right: 0px;width: 42px;">Time</div>
                <div class="col-sm-2" style="padding:0">
                    <input id="S_Edit_Service_Time" type="text" class="form-control" readonly style="border:1px #ff6a00 solid;position:relative;left:5px;width:85px;background-color:white;font-size:11px;height:24px;top:-5px;border-radius:3px" data-toggle="collapse" data-target="#S_Edit_TimePicker" />
                    <span class="glyphicon glyphicon-triangle-bottom" style="left:70px;color:black;top:-23px;">
                    </span>
                    <div id="S_Edit_TimePicker" class="collapse" style="width:100px; background-color:white; position:absolute; left:5px;top:30px;box-shadow: 4px 16px 8px 0px rgba(0,0,0,0.2);border-radius:5px;padding:0px 0px 0px 0px">
                        <div class="col-sm-12" style="background-color: white; border-radius:7px;padding:5px 0px 3px 0px;z-index:1048">
                            <div class="col-sm-4">
                                <div>
                                    <i class="glyphicon glyphicon-menu-up" aria-hidden="true" style="font-size:12px; font-weight:bold;color:#ff6a00" id="S_Edit_HoursUp"></i>
                                </div>
                                <div>
                                    <span id="S_Edit_Hours" style="color:black"></span>
                                </div>
                                <div>
                                    <i class="glyphicon glyphicon-menu-down" aria-hidden="true" style="font-size:12px; font-weight:bold;color:#ff6a00" id="S_Edit_HoursDown"></i>
                                </div>
                            </div>

                            <div class="col-sm-4" style="padding-left:10px">
                                <div>
                                    <i class="glyphicon glyphicon-menu-up" aria-hidden="true" style="font-size:12px; font-weight:bold;color:#ff6a00" id="S_Edit_MinUp"></i>
                                </div>
                                <div>
                                    <span id="S_Edit_Minutes" style="color:black"></span>
                                </div>
                                <div>
                                    <i class="glyphicon glyphicon-menu-down" aria-hidden="true" style="font-size:12px; font-weight:bold;color:#ff6a00" id="S_Edit_MinDown"></i>
                                </div>
                            </div>
                            <div class="col-sm-4" style="padding-left:5px">
                                <div>
                                    <i class="glyphicon glyphicon-menu-up" aria-hidden="true" style="font-size:12px; font-weight:bold;color:#ff6a00" id="S_Edit_AP_UP"></i>
                                </div>
                                <div style="text-align:center">
                                    <span id="S_Edit_AM_PM" style="font-size:10px;color:black;font-weight:bold"></span>
                                </div>
                                <div>
                                    <i class="glyphicon glyphicon-menu-down" aria-hidden="true" style="font-size:12px; font-weight:bold;color:#ff6a00" id="S_Edit_AP_Down"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-sm-4">&nbsp;</div>
        </div>
        <div class="col-sm-12">&nbsp;</div>
        <div class="col-sm-12">
            <div class="col-sm-1"></div>
            <div class="col-sm-4">
                <div class="btn-group btn-group-sm" style="width:100%">
                    <button type="button" class="mypopupbtncls btn" data-dismiss="modal" id="CancelSchedule" style="width:40%;border-radius: 5px 0px 0px 5px;border: 1px solid#fff;background-color: gray; color: white;font-size: 15px;">No</button>
                    <button type="button" id="UpdateScheduleBtn" class="mypopupbtncls btn" style="width:40%;border: 1px solid#fff;border-radius: 0px 5px 5px 0px;background-color: #FF6937; color: white;font-size: 15px;">Yes</button>
                </div>
            </div>
            <div class="col-sm-1"></div>
            <div class="col-sm-4">

            </div>
        </div>
    </div>
    <div class="col-sm-4" style="width:36%;padding:5px;background-color:#FDFDFD;box-shadow: 0px 1px 3px;">
        <div id="assigneddiv">
            <div class="col-sm-2">
                <div class="col-sm-12" style="padding:0">
                    <img src="~/asset_contacts/img/7th.png" id="assinged_photo" style="margin-bottom:4px!important;height:50px;width:50px;border-radius:50px;" />
                </div>
                <div class="col-sm-12" style="padding:0px;padding-left:8px;text-align:center;color:#ff5d26" id="assinged_type">
                    Buyer
                </div>
            </div>
            <div class="col-sm-2" style="padding:0;padding-left:7px">
                <div class="col-sm-12" style="font-weight:bold;padding:0" id="assinged_name">
                    Michele Hope
                </div>
                <div class="col-sm-12" style="padding:0;margin-top:15px  ">
                    <img class="sellerbuyer_Call" src="~/img/phone_icon_brand-1.png" style="cursor:pointer;margin-bottom:0px!important;" id="assinged_chat" />&nbsp;
                    <img class="sellerbuyer_Chat" src="~/img/chat8.png" style="cursor:pointer;margin-bottom:0px!important;" id="assinged_call" />
                </div>
            </div>
        </div>
        <div class="col-sm-3" id="clr_photo" style="background-size: 100% 100%;background-image:url(/img/NoImage.png);background-position:center;background-repeat: no-repeat;height:70px;"></div>
        <div class="col-sm-5" style="top:4px">
            <div class="col-sm-12" id="clr_addr1" style="font-weight:bold;font-size:14px;color:black;padding:0">101 Breaburn Drive</div>
            <div class="col-sm-12" id="clr_addr2" style="color:gray;padding:0">Greenville, Sc 123695</div>
            <div class="col-sm-12" id="clr_mlsno" style="color:gray;padding:0">MLS#1234567889</div>
        </div>
    </div>
</div>
@* REmove Closing Party popup *@
<div class="modal fade" id="RemoveClosingPopup" tabindex="-1" role="dialog" aria-labelledby="MessageLabel" aria-hidden="true" style="padding-left: 206px">
    <div class="modal-dialog" role="document" style="padding-top: 10%; width: 26%">
        <div class="modal-content">
            <div class="modal-header" style="text-align: center;color:#ff6937;height:45px;padding-top:13px;padding-left:10px!important;padding-right:10px!important">
                <label id="" style="font-weight:bold;font-size:18px!important">
                    <img src="~/img/Denny_icon.png" style="margin-bottom:0" />
                    <b>Remove Closing Party?</b>
                </label>
                <hr style="color:#ff6937;border: 1px solid;margin-top:5px;margin-bottom:10px" />
            </div>
            <div class="col-sm-12">&nbsp;</div>
            <div class="modal-body" style="padding-bottom:5px!important;padding-top:5px!important">
                <div class="col-md-12" style="text-align: center;padding-top:10px!important">
                    <label id="" style="word-wrap: break-word;font-size:14px;">
                        Are you sure want to remove this<br />
                        <b>CLosing Party?</b>
                    </label>
                </div>
                <div class="col-sm-12">&nbsp;</div>
                <div class="modal-footer">
                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-sm" style="width:100%">
                            <button type="button" class="mypopupbtncls btn" data-dismiss="modal" id="" style="width:50%;border-radius: 5px 0px 0px 5px;border: 1px solid#fff;background-color: gray; color: white;font-size: 15px;">No</button>
                            <button type="button" id="RemoveCloserPartyYesBtn" class="mypopupbtncls btn" style="width:50%;border: 1px solid#fff;border-radius: 0px 5px 5px 0px;background-color: #FF6937; color: white;font-size: 15px;">Yes</button>
                        </div>
                    </div>
                    <div class="col-sm-1"></div>
                </div>
            </div>
        </div>
    </div>
</div>
@* MessageSentPopup popup *@
<div class="modal fade" id="MessageSentPopup" tabindex="-1" role="dialog" aria-labelledby="MessageLabel" aria-hidden="true" style="z-index: 1600;padding-left: 206px">
    <div class="modal-dialog" role="document" style="padding-top: 10%; width: 26%">
        <div class="modal-content">
            <div class="modal-header" style="text-align: center;color:#ff6937;height:45px;padding-top:13px;padding-left:10px!important;padding-right:10px!important">
                <label id="" style="font-weight:bold;font-size:18px!important">
                    <img src="~/img/messageicon_popup.png" style="margin-bottom:0" />
                    <b>Message Sent</b>
                </label>
                <hr style="color:#ff6937;border: 1px solid;margin-top:5px;margin-bottom:10px" />
            </div>
            <div class="col-sm-12">&nbsp;</div>
            <div class="modal-body" style="padding-bottom:5px!important;padding-top:5px!important">
                <div class="col-md-12" style="text-align: center;padding-top:10px!important">
                    <label id="" style="word-wrap: break-word;font-size:14px;">
                        Your service request message has been sent to <b id="closerpartyname"></b>.<br /><br />
                        Quitchet will notify you receive a response.
                    </label>
                </div>
                <div class="col-sm-12">&nbsp;</div>
                <div class="modal-footer">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6">
                        <button type="button" id="" data-dismiss="modal" class="mypopupbtncls btn form-control" style="border: 1px solid#fff;border-radius: 5px;background-color: #FF6937; color: white;font-size: 15px;">Ok</button>
                    </div>
                    <div class="col-sm-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>
@*Alert Message while moving Closer if already exist*@
<div class="modal fade" id="AlertMessagePopup" tabindex="-1" role="dialog" aria-labelledby="MessageLabel" aria-hidden="true" style="z-index: 1600;padding-left: 206px">
    <div class="modal-dialog" role="document" style="padding-top: 12%; width: 22%">
        <div class="modal-content">
            <div class="modal-header" style="text-align: center;color:#ff6937;height:45px;padding-top:13px;">
                <label id="" style="font-size:16px">
                    <img src="~/img/expl_mark_icon.png" style="margin-bottom:0;height:15px;width:15px" />&nbsp;&nbsp;Unable to move listing to closing!
                </label>
                <hr style="color:#ff6937;border: 0.5px solid;margin-top:7px;" />
            </div>
            <div class="col-sm-12">&nbsp;</div>
            <div class="modal-body">
                <div class="col-md-12" style="text-align: center">
                    <label id="" style="word-wrap: break-word;">
                        This listing is already in closing process with another buyer agent.<br /><br />
                        Contact the listing agent if you think this is an error.
                    </label>
                </div>
                <div class="col-sm-12">&nbsp;</div>
                <div class="modal-footer" style="padding:0">
                    <div class="col-md-3">&nbsp;</div>
                    <div class="col-md-6" style="text-align: center">
                        <button type="button" data-dismiss="modal" class="btn btn-primary closeorangebtn" style="border-radius: 5px 5px 5px 5px  !important; background-color: #ff6937!important; color: white;font-size: 15px;width:100%">Ok</button>
                    </div>
                    <div class="col-md-3">&nbsp;</div>
                </div>
            </div>
        </div>
    </div>
</div>
@* Cancel Closing Confrimation popup *@
<div class="modal fade" id="CancelClosingConfirmationPopup" tabindex="-1" role="dialog" aria-labelledby="MessageLabel" aria-hidden="true" style="padding-left: 206px">
    <div class="modal-dialog" role="document" style="padding-top: 10%; width: 24%">
        <div class="modal-content">
            <div class="modal-header" style="text-align: center;color:#ff6937;height:30px;padding-top:13px;padding-left:10px!important;padding-right:10px!important">
                <label id="" style="font-weight:bold;font-size:18px!important">
                    <b>Cancel this Closing?</b>
                </label>
                <hr style="color:#ff6937;border: 1px solid;margin-top:5px;margin-bottom:10px" />
            </div>
            <div class="col-sm-12">&nbsp;</div>
            <div class="modal-body" style="padding-bottom:5px!important;font-size:15px">
                <div class="col-md-12" style="text-align: center;padding-top:10px!important">
                    <b style="color:#ff5d26">
                        Are you sure you want to cancel this closing in Quitchet?
                    </b>
                </div>
                <div class="col-md-12" style="text-align: center;padding-top:10px!important">
                    <label id="" style="word-wrap: break-word;font-size:13px;">
                        Cancelling this closing will mark the closing as if it failed to close.<br /><br />
                        If this closing process is complete and the property was sold, then Quitchet will automatically
                        remove it from Closer and archive it when the status of the listing changes to <b>Sold</b> in this <b>MLS.</b>
                    </label>
                </div>
                <div class="col-sm-12">&nbsp;</div>
                <div class="modal-footer">
                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-sm" style="width:100%">
                            <button type="button" class="mypopupbtncls btn" data-dismiss="modal" id="" style="width:50%;border-radius: 5px 0px 0px 5px;border: 1px solid#fff;background-color: gray; color: white;font-size: 15px;">No</button>
                            <button type="button" id="CancelClosingYesBtn" data-dismiss="modal" data-target="#CommentsforCancelledClosingPopup" data-toggle="modal" class="mypopupbtncls btn" style="width:50%;border: 1px solid#fff;border-radius: 0px 5px 5px 0px;background-color: #FF6937; color: white;font-size: 15px;">Yes</button>
                        </div>
                    </div>
                    <div class="col-sm-1"></div>
                </div>
            </div>
        </div>
    </div>
</div>
@* Adding Comments to Cancelled Clolsing  popup *@
<div class="modal fade" data-backdrop="static" data-keyboard="false" id="CommentsforCancelledClosingPopup" tabindex="-1" role="dialog" aria-labelledby="MessageLabel" aria-hidden="true" style="padding-left: 206px">
    <div class="modal-dialog" role="document" style="padding-top: 10%; width: 21%">
        <div class="modal-content">
            <div class="modal-header" style="text-align: center;color:#ff6937;height:30px;padding-top:13px;padding-left:10px!important;padding-right:10px!important">
                <label id="" style="font-weight:bold;font-size:18px!important">
                    <b>Closing Cancelled</b>
                </label>
                <hr style="color:#ff6937;border: 1px solid;margin-top:5px;margin-bottom:10px" />
            </div>
            <div class="col-sm-12">&nbsp;</div>
            <div class="modal-body" style="font-size:15px">
                <div class="col-md-12" style="text-align: center;padding-top:10px!important">
                    <label id="errorMessageforClosingComments" style="color:red;display:none;font-size:12px;">Please Enter Comments</label>
                    <label id="" style="word-wrap: break-word;font-size:13px;">
                        Add notes to be archived with this failed closing:
                    </label>
                </div>
                <div class="col-md-12" style="text-align: center;padding-top:10px!important">
                    <textarea id="closingcomments" class="form-control" style="resize:none; height:100px;border:1px solid #ff5d26;background-color:rgb(251, 236, 230)"></textarea>
                </div>
                <div class="col-sm-12">&nbsp;</div>
                <div class="modal-footer">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6">
                        <button type="button" id="AddCommentsBtn" class="mypopupbtncls btn form-control" style="border: 1px solid#fff;border-radius: 5px;background-color: #FF6937; color: white;font-size: 15px;">Done</button>
                    </div>
                    <div class="col-sm-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>
@* Phone Call Popup*@
<div class="modal fade" id="PhoneCallModel" style="padding-left: 206px; z-index: 1500;">
    <div class="modal-dialog" role="document" style="padding-top: 15%; width: 25%">
        <div class="modal-content">
            <div class="modal-header" style="text-align: center; border-bottom: none; padding-bottom: 0px;">
                <h5 style="color: #FF6937; margin-top: -2%; font-weight: 600;">Phone Call</h5>
                <img src="~/img/phone_icon_brand-1.png" />&nbsp; <span id="name" style="font-size: 12px; color: black; font-weight: bold; margin-top: 0px">Phone Call</span>
                <hr style="border: 0 ! important; margin-top: 2%; margin-bottom: 5%; border-top: 1px solid  #FF6937 !important;" />
            </div>
            <div class="col-sm-12">
                <div class="col-sm-6">
                    <img style="margin-right: 1px;" src="~/img/mb.png" />&nbsp;  <span style="font-size: 11px; color: #FF6937;">Mobile</span>
                </div>
                <div class="col-sm-6">
                    <span id="phonenumber" style="font-size: 11px;">987654321</span>
                </div>
            </div>
            <div class="col-sm-12">&nbsp;</div>
            <div class="col-sm-12">
                <hr style="margin-bottom: 2%; margin-top: 2%;" />
            </div>
            <div class="modal-footer">
                <div class="col-sm-12" style="text-align: center">
                    <a href="#" class="btn" id="phonecall_popup_cancel" data-dismiss="modal" style="border-radius: 5px !important; background-color: gray; color: white; font-weight: 500; font-size: 11px;">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div>
@*Add New Closing for Buying Popup*@
<div class="modal fade" id="AddClosingForBuying_Popup" tabindex="-1" role="dialog" aria-labelledby="MessageLabel" aria-hidden="true" style="padding-left: 206px">
    <div class="modal-dialog" role="document" style="padding-top: 10%; width: 26%">
        <div class="modal-content">
            <div class="modal-header" style="text-align: center;color:#ff6937;height:45px;padding-top:13px;padding-left:10px!important;padding-right:10px!important">
                <label id="" style="font-weight:bold;font-size:18px!important">
                    Add New Closing - Buying
                </label>
                <hr style="color:#ff6937;border: 0.5px solid;margin-top:5px;margin-bottom:10px" />
            </div>
            <div class="col-sm-12">&nbsp;</div>
            <div class="modal-body" style="padding-bottom:5px!important;padding-top:5px!important">
                <label id="errorMessageforMLSID" style="color:red"></label>
                <div class="col-md-12">
                    <label id="" style="word-wrap: break-word;font-size:14px;">
                        Select your buyer
                    </label>
                </div>
                <div class="col-md-12" style="">
                    <select class="selectpicker form-control" id="activebuyer"></select>
                </div>
                <div class="col-md-12" style="margin-top:10px!important">
                    <label id="" style="word-wrap: break-word;font-size:14px;">
                        Property being purchased
                    </label>
                </div>
                <div class="col-md-12" style="text-align: center;">
                    <div class="right-inner-addon">
                        <i class="fa fa-search" aria-hidden="true"></i>
                        <input type="search" id="mlsforbuying" class="form-control" placeholder="MLS# or Address" />
                    </div>
                </div>
                <div class="col-sm-12" style="padding:10px">&nbsp;</div>
                <div class="modal-footer">
                    <div class="col-sm-2">&nbsp;</div>
                    <div class="col-sm-8">
                        <div class="btn-group btn-group-sm" style="width:100%">
                            <button type="button" class="mypopupbtncls btn" data-dismiss="modal" id="AcceptReq_NoBtn" style="border-radius: 5px 0 0 5px;width: 50%;border: 1px solid#fff;background-color: gray; color: white;font-size: 15px;">Cancel</button>
                            <button type="button" id="SaveClosingforBuying" disabled="disabled" class="mypopupbtncls btn" style="border: 1px solid#fff;border-radius:0 5px 5px 0;width: 50%;background-color: #FF6937; color: white;font-size: 15px;">Save</button>
                        </div>
                    </div>
                    <div class="col-sm-2">&nbsp;</div>
                </div>
            </div>
        </div>
    </div>
</div>
@*Add New Closing for Selling Popup*@
<div class="modal fade" id="AddClosingForSelling_Popup" tabindex="-1" role="dialog" aria-labelledby="MessageLabel" aria-hidden="true" style="padding-left: 206px">
    <div class="modal-dialog" role="document" style="padding-top: 10%; width: 26%">
        <div class="modal-content">
            <div class="modal-header" style="text-align: center;color:#ff6937;height:45px;padding-top:13px;padding-left:10px!important;padding-right:10px!important">
                <label id="" style="font-weight:bold;font-size:18px!important">
                    Add New Closing - Selling
                </label>
                <hr style="color:#ff6937;border: 0.5px solid;margin-top:5px;margin-bottom:10px" />
            </div>
            <div class="col-sm-12">&nbsp;</div>
            <div class="modal-body" style="padding-bottom:5px!important;padding-top:5px!important">
                <label id="errorMessageforSellingMLSID" style="color:red"></label>
                <div class="col-md-12">
                    <label id="" style="word-wrap: break-word;font-size:14px;">
                        Select your listing
                    </label>
                </div>
                <div class="col-md-12" style="">
                    <div class="right-inner-addon">
                        <i class="fa fa-search" aria-hidden="true"></i>
                        <input type="search" id="mymlsforselling" class="form-control" placeholder="MLS# or Address" />
                    </div>
                </div>
                <div class="col-md-12" style="margin-top:10px!important">
                    <label id="" style="word-wrap: break-word;font-size:14px;">
                        Select buyer agent
                    </label>
                </div>
                <div class="col-md-12" style="text-align: center;">
                    <div class="right-inner-addon">
                        <i class="fa fa-search" aria-hidden="true"></i>
                        <input type="search" id="buyerforselling" class="form-control" placeholder="Contact" />
                    </div>
                </div>
                <div class="col-sm-12" style="padding:10px">&nbsp;</div>
                <div class="modal-footer">
                    <div class="col-sm-2">&nbsp;</div>
                    <div class="col-sm-8">
                        <div class="btn-group btn-group-sm" style="width:100%">
                            <button type="button" class="mypopupbtncls btn" data-dismiss="modal" id="AcceptReq_NoBtn" style="border-radius: 5px 0 0 5px;width: 50%;border: 1px solid#fff;background-color: gray; color: white;font-size: 15px;">Cancel</button>
                            <button type="button" id="SaveClosingforSelling" class="mypopupbtncls btn" style="border: 1px solid#fff;border-radius:0 5px 5px 0;width: 50%;background-color: #FF6937; color: white;font-size: 15px;">Save</button>
                        </div>
                    </div>
                    <div class="col-sm-2">&nbsp;</div>
                </div>
            </div>
        </div>
    </div>
</div>
@*Add New Closing for Buying Popup*@
<div class="modal fade" id="AddBuyerPopup" tabindex="-1" role="dialog" aria-labelledby="MessageLabel" aria-hidden="true" style="padding-left: 206px">
    <div class="modal-dialog" role="document" style="padding-top: 10%; width: 26%">
        <div class="modal-content">
            <div class="modal-header" style="text-align: center;color:#ff6937;height:45px;padding-top:13px;padding-left:10px!important;padding-right:10px!important">
                <label id="" style="font-weight:bold;font-size:18px!important">
                    Assign the Buyer
                </label>
                <hr style="color:#ff6937;border: 0.5px solid;margin-top:5px;margin-bottom:10px" />
            </div>
            <div class="col-sm-12">&nbsp;</div>
            <div class="modal-body" style="padding-bottom:5px!important;padding-top:5px!important">
                <label id="errorMessageforbuyerpopup2" style="color:red"></label>
                <div class="col-md-12">
                    <label id="" style="word-wrap: break-word;font-size:15px;color:#ff5d26;">
                        Select a buyer to assign them to this closing.
                    </label>
                </div>
                <div class="col-md-12">
                    <label id="" style="word-wrap: break-word;font-size:14px;">
                        Select your buyer
                    </label>
                </div>
                <div class="col-md-12" style="">
                    <select class="selectpicker form-control" id="activebuyerpopup2"></select>
                </div>
                <div class="col-sm-12" style="padding:10px">&nbsp;</div>
                <div class="modal-footer">
                    <div class="col-sm-2">&nbsp;</div>
                    <div class="col-sm-8">
                        <div class="btn-group btn-group-sm" style="width:100%">
                            <button type="button" class="mypopupbtncls btn" data-dismiss="modal" id="AcceptReq_NoBtn" style="border-radius: 5px 0 0 5px;width: 50%;border: 1px solid#fff;background-color: gray; color: white;font-size: 15px;">Cancel</button>
                            <button type="button" id="SaveClosingforBuyingPopup2" class="mypopupbtncls btn" style="border: 1px solid#fff;border-radius:0 5px 5px 0;width: 50%;background-color: #FF6937; color: white;font-size: 15px;">Save</button>
                        </div>
                    </div>
                    <div class="col-sm-2">&nbsp;</div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var isQC_User = '';
    var message, repdate = "##DATE##", reptime = "##TIME##";
    var watemark = '<div style="padding:30px;text-align:center"><img src="/img/Closer_dashboard.png" /></div>';
    $("#S_Service_Date").datepicker({
        beforeShow: function (input, inst) {
            inst.dpDiv.css({ marginLeft: '-75px' });
        },
        dateFormat: 'mm/dd/yy',
        dayNamesMin: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
        minDate: 0,
        onSelect: function (date) {
            message = message.replace(repdate, date);
            repdate = date;
            // alert(message)
            $("#msg").html(message);
        },
    })//DAte Picker in Schedule Closing Party
    $(document).ready(function () {
        //AgentFullDetailsView("734", "1354920");
        //$("#MessageSentPopup").modal('show')
        $('#mymenuli').addClass('menuactive');
        //alert(AgentId)
        $("#ScheduleAndEditDiv").hide();
        loadActiveBuyers();
        getBuyingListings();
        // BuyingListingManage()
        //a();
        // b();
        //  c();
    });//Page load function
    $('#AddClosingForSelling_Popup').on('shown.bs.modal', function () {
        $("#errorMessageforSellingMLSID").text('');
        $("#mymlsforselling").val('');
        $("#buyerforselling").val('');
    });//Clear fields while Opening Popup
    var closingPKeyID = "", closingType = "",closingpartyID="";//Global variables
    function getBuyingListings() {
        $.ajax({
            url: "/Agent/AgentCloser/GetMyBuyingListings",
            type: "GET",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: { AgentID: AgentId },
            success: function (data) {
                if (data.length > 0) {
                    Bind_buying_litings(data);
                }
                else {

                }
            }
        });
    }//Function to get Closing s in Buying Tab
    function Bind_buying_litings(data) {
        $("#buyinglistings_div").empty(data);
        $.each(data, function (i, exp) {
            var imagepin = "", price = "";
            var bedrooms, bathrooms, sqftAcres;
            var BtnPrevImgId = "Prev" + data[i].MLSID;
            var BtnNextImgId = "Next" + data[i].MLSID;
            var PrpImagesArray = []
            var DivImgId = "div_" + data[i].MLSID;
            var PhotosURL = [], TotalImages = [];
            PrpImagesArray = [];
            if (data[i].PRP_IMAGES != null && data[i].PRP_IMAGES != "" && data[i].PRP_IMAGES != ",") {
                var c = data[i].PHOTO_COUNT;
                PrpImagesArray = data[i].PRP_IMAGES.split(',');
                TotalImages.push(data[i].PRP_IMAGES);
                if (TotalImages.length > 0)
                    PhotosURL = data[i].PRP_IMAGES.split(',');
                else
                    PhotosURL[0] = data[i].PRP_IMAGES;
            }
            else {
                PhotosURL[0] = '/img/NoImage.png';
            }
            if (data[i].Class == "Rental") {
                price = "$ " + (data[i].PRP_PRICE + "").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,") + "/mo";
                //if (data[i].Is_Viewd == "YES")
                //    imagepin = '<img src="/img/viewed_graypin.png" height="20" style="position:relative; top:-2px" />'
                //else
                imagepin = '<img src="/img/gray_legendMenu.png" height="20" style="position:relative; top:-2px" />'
            }
            else {
                price = "$ " + (data[i].PRP_PRICE + "").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
                if (data[i].Status == "Active") {
                    //if (data[i].Is_Viewd == "YES")
                    //    imagepin = '<img src="/img/viewed_greenpin.png" height="20" style="position:relative; top:-2px" />'
                    //else
                    imagepin = '<img src="/img/Green_legend_Menu.png" height="20" style="position:relative; top:-2px" />'
                }
                else if (data[i].Status == "Pending") {
                    //if (data[i].Is_Viewd == "YES")
                    imagepin = '<img src="/img/yellow_legendMenu.png" height="20" style="position:relative; top:-2px;margin-left: -3px;" />'
                    //else
                    //    imagepin = '<img src="/img/viewed_yellowpin.png" height="20" style="position:relative; top:-2px" />'
                }
                else if (data[i].Status == "Sold") {
                    //if (data[i].Is_Viewd == "YES")
                    imagepin = '<img src="/img/red_legendMenu.png" height="20" style="position:relative; top:-2px;margin-left: -3px;" />'
                    //else
                    //    imagepin = '<img src="/img/viewed_yellowpin.png" height="20" style="position:relative; top:-2px" />'
                }
            }

            if (TotalImages.length > 0) {
                var photosdiv = '<div class="col-sm-2" style="height: 110px; position: relative; background-image: url(' + PhotosURL[0] + '); background-size: 100% 100%;" id="' + DivImgId + '">'
                                       + '<div class="col-sm-12" style="margin-top: 13%;padding: 15px;"><a href="#"><img src="/img/SliderBackArrow.png" onclick="return PrpImageSlider(\'' + imgindex + '\',\'' + "-1" + '\',\'' + DivImgId + '\',\'' + PrpImagesArray + '\',\'' + data[i].MLSID + '\')" width="21" height="29" alt="" style="margin-left: -24%;" id="' + BtnPrevImgId + '" hidden="hidden"/></a>'
                                       + '<a href="#"><img src="/img/SliderNextArrow.png" width="21" height="29" onclick="return PrpImageSlider(\'' + imgindex + '\',\'' + "1" + '\',\'' + DivImgId + '\',\'' + PrpImagesArray + '\',\'' + data[i].MLSID + '\')" alt="" style="float: right;margin-right: -24%;" id="' + BtnNextImgId + '"   /></a></div>'
                                       + '</div>';
            }
            else {
                var photosdiv = '<div class="col-sm-2" style="height: 110px; position: relative; background-image: url(' + PhotosURL[0] + '); background-size: 100% 100%;" id="' + DivImgId + '">'
                                       + '<div class="col-sm-12" style="margin-top: 13%;padding: 15px;"><a href="#"><img src="/img/SliderBackArrow.png" onclick="return PrpImageSlider(\'' + imgindex + '\',\'' + "-1" + '\',\'' + DivImgId + '\',\'' + PrpImagesArray + '\',\'' + data[i].MLSID + '\')" width="21" height="29" alt="" style="margin-left: -20%;" id="' + BtnPrevImgId + '" hidden="hidden"/></a>'
                                       + '<a href="#"><img src="/img/SliderNextArrow.png" width="21" height="29" onclick="return PrpImageSlider(\'' + imgindex + '\',\'' + "1" + '\',\'' + DivImgId + '\',\'' + PrpImagesArray + '\',\'' + data[i].MLSID + '\')" alt="" style="float: right;margin-right: -17%;" id="' + BtnNextImgId + '"    hidden="hidden"/></a></div>'
                                       + '</div>';
            }
            var addr11 = data[i].PRP_ADDRESS.split(',')[1];
            var addr12 = (data[i].PRP_ADDRESS.split(',')[2] != undefined) ? "," + data[i].PRP_ADDRESS.split(',')[2] : "";
            var listing = '<div class="col-sm-12" style="padding: 15px;border-bottom: 2px solid #ff5d26;">' + photosdiv
                          + '<div class="col-sm-7" style="border-right: 1px solid lightgray;height: 110px;"><div class="col-sm-12">' + imagepin
                          + '<span id="Rate" style="left:2px;color:#ff5d26;font-size:16px; font-weight:bold; position:relative; ">' + price + '</span></div>'
                          + '<div class="col-sm-12" style="font-weight:bold;font-size:18px;">' + data[i].PRP_ADDRESS.split(',')[0] + '</div>'
                          + '<div class="col-sm-12" style="font-size:14px">' + addr11 + '' + addr12 + '</div>'
                           + '<div class="col-sm-12" style="font-size:14px">MLS#' + data[i].MLSID + '</div></div>'
                           + '<div class="col-sm-3" style="text-align:center;line-height:6"><a href="#" onclick="return BuyingListingManage(\'' + data[i].PK_ClosingID + '\',\'Buying\')" style="font-weight:bold;text-decoration:none;font-size:16px;color:#ff5d26">Manage</a>'
                           + '<img class="sideArrow" style="top:28px;float: right; position: relative;cursor:pointer" src="/img/lit_icon_btn.png" onclick="AgentFullDetailsView(\'' + AgentId + '\', \'' + data[i].MLSID + '\')"></div>'
                          + '</div>';
            $("#buyinglistings_div").append(listing);
        });
    }//Bind Closings in Buying Tab 
    function BuyingListingManage(ClosingID, Type) {
        closingPKeyID = ClosingID, closingType = Type;
        if (closingType == "Buying") {
            $("#assignedtoagentDiv").text('Assign to Listing Agent');
        }
        else if (closingType == "Selling") {
            $("#assignedtoagentDiv").text('Assign to Buyer Agent');
        }
        $("#tabmenu").hide();
        $("#horizontalbor").show();
        $("#manageDiv").show();
        $("#editClosings").show();
        $("#backBtn").hide();
        $("#assignedtome_Data_Div").empty();
        $("#assignedtobuyer_Data_Div").empty();
        $("#assignedtoagent_Data_Div").empty();
        $("#table_1 tbody tr").find('td:first-child').hide();
        $("#table_2 tbody tr").find('td:first-child').hide();
        $("#table_3 tbody tr").find('td:first-child').hide();
        $.ajax({
            url: "/Agent/AgentCloser/GetClosingListDetails",
            type: "GET",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: { PK_ClosingID: ClosingID },
            success: function (data) {
                var price;
                if (data[0].Class == "Rental") {
                    price = "$ " + (data[0].PRP_PRICE + "").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,") + "/mo";
                }
                else {
                    price = "$ " + (data[0].PRP_PRICE + "").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
                }
                //if (data[0].PHOTO_COUNT > 0)
                //    $('#closinglist_image').css({ 'background-image': 'url(' + data[0].PRP_IMAGES.split(',')[0] + ')' });
                //else
                //    $('#closinglist_image').css({ 'background-image': 'url(/img/picture_area.png)' });
                
                if (data[0].PRP_IMAGES != '' && data[0].PRP_IMAGES != null && data[0].PRP_IMAGES != "null") {
                   
                    if (data[0].PRP_IMAGES.indexOf(',') > -1) {
                        $('#closinglist_image').css('backgroundImage', 'url(' + data[0].PRP_IMAGES.split(',')[0] + ')');
                    }
                    else {
                        $('#closinglist_image').css('backgroundImage', 'url(' + data[0].PRP_IMAGES + ')');
                    }
                }
                else {
                    $('#closinglist_image').css('backgroundImage', 'url("/img/NoImage.png")');
                }
                $("#closinglist_price").text(price);
                $("#closinglist_addr1").text(data[0].PRP_ADDRESS.split(',')[0]);
                var addr11 = data[0].PRP_ADDRESS.split(',')[1];
                var addr12 = (data[0].PRP_ADDRESS.split(',')[2] == "undefined") ? ", " + data[0].PRP_ADDRESS.split(',')[2] : "";
                $("#closinglist_addr2").text(addr11 + addr12);
                $("#closinglist_mlsid").text("MLS#" + data[0].MLSID);
                if (data[0].Closing_TypeID == "1" || (data[0].Closing_TypeID == "2" && closingType == "Buying")) {
                    if (AgentId == data[0].ListingAgentID) {
                        $("#phonechatdiv").hide();
                        $("#assignedtoagentDiv").hide();
                    }
                    else {
                        $("#phonechatdiv").show();
                        $("#assignedtoagentDiv").show();
                    }
                    $("#listingagenttype").text('Listing Agent');
                    $("#customertype").text("Buyer"); 
                    $("#listingagent_id").text(data[0].ListingAgentID);
                    $("#listingagent_pk_userid").text(data[0].ListingAgent_PkUserID);
                    $("#listingagent_phone").text(data[0].ListingAgent_MobileNo);
                    $("#listingagent_mail").text(data[0].ListingAgent_Email);
                    
                    if (data[0].ListingAgent_Image != null && data[0].ListingAgent_Image != "" && data[0].ListingAgent_Image != ",")
                        $("#listingagent_photo").attr('src', data[0].ListingAgent_Image);
                    else
                        $("#listingagent_photo").attr('src', "/img/addphotopic.png");
                    $("#listingagent_name").text(data[0].ListingAgent_FirstName + " " + data[0].ListingAgent_LastName);
                    if (data[0].ListingAgent_PkUserID != null && data[0].ListingAgent_PkUserID != "null" && data[0].ListingAgent_PkUserID != "") {
                        //$('#lachatdiv').show();
                        isQC_User = 'YES';
                    }
                    else {
                        //$('#lachatdiv').hide();
                        isQC_User = 'NO';
                    }
                    $("#listingagent_company").text(data[0].ListingAgent_Office);
                    if (data[0].BuyerID != "" && data[0].BuyerID != null) {
                        if (data[0].Buyer_Image != null && data[0].Buyer_Image != "" && data[0].Buyer_Image != ",")
                            $("#sellerbuyer_photo").attr('src', data[0].Buyer_Image);
                        else
                            $("#sellerbuyer_photo").attr('src', "/img/addphotopic.png");
                        $("#sellerbuyer_name").text(data[0].Buyer_FirstName + " " + data[0].Buyer_LastName);
                        //alert(data[0].SellerID)
                        $("#sellerbuyer_id").text(data[0].BuyerID);
                        $("#sellerbuyer_Pkey_userid").text(data[0].BuyerAgent_PKUserID);
                        $("#sellerbuyer_phone").text((data[0].Buyer_MobileNo == null) ? "No Phone" : data[0].Buyer_MobileNo);
                        $("#hadseller").show();
                        $("#noseller").hide();
                    }
                    else {
                        $("#hadseller").hide();
                        $("#noseller").show();
                    }
                    if (data[0].ListingAgent_Primary_Color != null && data[0].ListingAgent_Primary_Color != '') {
                        $('#agentsmaindiv').css('background-color', data[0].ListingAgent_Primary_Color);
                    }
                    else {
                        $('#agentsmaindiv').css('background-color', '#99A3A4');
                    }
                    if (data[0].ListingAgent_Secondary_Color != null && data[0].ListingAgent_Secondary_Color != '') {
                        $('#agentsmaindiv').css('color', data[0].ListingAgent_Secondary_Color);
                    }
                    else {
                        $('#agentsmaindiv').css('color', 'black');
                    }
                    
                }
                else if (data[0].Closing_TypeID == "2" && closingType == "Selling") {
                    $("#listingagenttype").text('Buyer Agent');
                    $("#customertype").text("Seller");
                    $("#listingagent_id").text(data[0].BuyerAgentID);
                    $("#sellerbuyer_Pkey_userid").text(data[0].BuyerAgent_PKUserID);
                    $("#listingagent_phone").text(data[0].BuyerAgent_MobileNo);
                    $("#listingagent_email").text(data[0].BuyerAgent_Email);
                    $("#listingagent_pk_userid").text(data[0].ListingAgent_PkUserID);
                    if (data[0].BuyerAgent_Image != null && data[0].BuyerAgent_Image != "" && data[0].BuyerAgent_Image != ",")
                        $("#listingagent_photo").attr('src', data[0].BuyerAgent_Image);
                    else
                        $("#listingagent_photo").attr('src', "/img/addphotopic.png");
                    if (data[0].BuyerAgent_PKUserID != null && data[0].BuyerAgent_PKUserID != "null" && data[0].BuyerAgent_PKUserID != "") {
                        //$('#lachatdiv').show();
                        isQC_User = 'YES';
                    }
                    else {
                        isQC_User = 'NO';
                        //$('#lachatdiv').hide();
                    }
                    $("#listingagent_name").text(data[0].BuyerAgent_FirstName + " " + data[0].BuyerAgent_LastName);
                    $("#listingagent_company").text(data[0].BuyerAgent_Office);
                    if (data[0].SellerID != "" && data[0].SellerID != null) {
                        if (data[0].Seller_Image != null && data[0].Seller_Image != "" && data[0].Seller_Image != ",")
                            $("#sellerbuyer_photo").attr('src', data[0].Seller_Image);
                        else
                            $("#sellerbuyer_photo").attr('src', "/img/addphotopic.png");
                        $("#sellerbuyer_name").text(data[0].Seller_FirstName + " " + data[0].Seller_LastName);
                        //alert(data[0].SellerID)
                        $("#sellerbuyer_id").text(data[0].SellerID);
                        $("#listingagent_pk_userid").text(data[0].SellerID);
                        $("#sellerbuyer_phone").text((data[0].Seller_MobileNo == null) ? "No Phone" : data[0].Seller_MobileNo);
                        $("#hadseller").show();
                        $("#noseller").hide();
                    }
                    else {
                        $("#hadseller").hide();
                        //  $("#noseller").show();
                    }
                    if (data[0].BuyerAgent_Primary_Color != null && data[0].BuyerAgent_Primary_Color != '') {
                        $('#agentsmaindiv').css('background-color', data[0].BuyerAgent_Primary_Color);
                    }
                    else {
                        $('#agentsmaindiv').css('background-color', '#99A3A4');
                    }
                    if (data[0].BuyerAgent_Secondary_Color != null && data[0].BuyerAgent_Secondary_Color != '') {
                        $('#agentsmaindiv').css('color', data[0].BuyerAgent_Secondary_Color);
                    }
                    else {
                        $('#agentsmaindiv').css('color', 'black');
                    }
                }
            }
        });
    }//Bind Closing In manage Div
    $(".listingagent_Chat").click(function () {
        var bg = $("#closinglist_image").css('background-image');
        bg = bg.replace('url(', '').replace(')', '');
        bg = bg.replace('"', '');
        bg = bg.replace('"', '');
        $('#prop_mlc').text($("#closinglist_mlsid").text());
        $('#prop_addr1').text($('#closinglist_addr1').text());
        $('#prop_addr2').text($('#closinglist_addr2').text());
        $('#prop_img').attr('src', bg);
        $('#property_div').show();
        if(isQC_User=='YES')
            creatConnection($("#listingagent_pk_userid").text(), $("#listingagent_name").text(), ' 3 ', $("#listingagent_photo").attr('src'), $("#closinglist_mlsid").text().split('#')[1]);
        else if(isQC_User=='NO')
            creatConnectionforNonQCUsers($("#listingagent_mail").text(), $("#listingagent_phone").text(), $("#listingagent_name").text(), $("#closinglist_mlsid").text().split('#')[1], ' 3 ', $("#listingagent_photo").attr('src'))
    })//Chat Event for Listing Agent
    $(".listingagent_Call").click(function () {
        $("#PhoneCallModel").modal('show');
        $("#name").text($("#listingagent_name").text())
        $("#phonenumber").text($("#listingagent_phone").text())
    })//CAll event for Listing Agent
    $(".sellerbuyer_Chat").click(function () {
        var bg = $("#closinglist_image").css('background-image');
        bg = bg.replace('url(', '').replace(')', '');
        bg = bg.replace('"', '');
        bg = bg.replace('"', '');    
        $('#prop_mlc').text($("#closinglist_mlsid").text());
        $('#prop_addr1').text($('#closinglist_addr1').text());
        $('#prop_addr2').text($('#closinglist_addr2').text());
        $('#prop_img').attr('src', bg);
        $('#property_div').show();
        creatConnection($("#sellerbuyer_Pkey_userid").text(), $("#sellerbuyer_name").text(), ' 3 ', $("#sellerbuyer_photo").attr('src'), $("#closinglist_mlsid").text().split('#')[1]);
    })//Chat event fior Seller/Buyer
    $(".sellerbuyer_Call").click(function () {
        $("#PhoneCallModel").modal('show');
        $("#name").text($("#sellerbuyer_name").text())
        $("#phonenumber").text($("#sellerbuyer_phone").text())
    })//CAll event fior Seller/Buyer
    function loadActiveBuyers() {
        $.ajax({
            url: "/Agent/MyCustomers/GetBuyers",
            type: "GET",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: { AgentID: AgentId },
            success: function (data) {
                if (data.length > 0) {
                    $('#activebuyer').find('option').remove().end();
                    $('#activebuyer').append('<option value="' + 0 + '">Contact</option>');
                    $('#activebuyerpopup2').find('option').remove().end();
                    $('#activebuyerpopup2').append('<option value="' + 0 + '">Contact</option>');
                    $.each(data, function (i, item) {

                        $('#activebuyer').append($("<option></option>").attr("value", data[i].FK_UserID).text(data[i].First_Name + ' ' + data[i].Last_Name));
                        $('#activebuyerpopup2').append($("<option></option>").attr("value", data[i].FK_UserID).text(data[i].First_Name + ' ' + data[i].Last_Name));
                    });
                    $("#activebuyer").selectpicker("refresh");
                    $("#activebuyerpopup2").selectpicker("refresh");
                }
                else {
                    $('select[id=activebuyer]').val(0);
                    $("#activebuyer").selectpicker("refresh");
                    $('select[id=activebuyerpopup2]').val(0);
                    $("#activebuyerpopup2").selectpicker("refresh");
                }
            }
        });
    }//Function to get My Active Buyers
    $("#backBtn2").click(function () {
        $("#tabmenu").show();
        $("#manageDiv").hide();
        $("#editClosings").hide();
        $("#backBtn").show();
    })//Back to Buying/Selling Tabs
    $("#activebuyer").change(function () {
        if ($(this).val() != 0) {
            $("#SaveClosingforBuying").addClass('btnenable')
            $('#SaveClosingforBuying').prop("disabled", false);
            $("#errorMessageforMLSID").text('')
        }

        else {
            $("#SaveClosingforBuying").removeClass('btnenable').addClass('btndisble');
            $('#SaveClosingforBuying').prop("disabled", true);
            $("#errorMessageforMLSID").text('Select Buyer')
        }

    });//Buyers Dropdown change event
    $("#mlsforbuying").keyup(function () {
        if ($(this).val() != 0) {
            $("#SaveClosingforBuying").addClass('btnenable')
            $('#SaveClosingforBuying').prop("disabled", false);
            $("#errorMessageforMLSID").text('')
        }
    });//MLS_Search Key up functionalaity to cleare error msg in add list to Buying Popup
    $("#mymlsforselling").keyup(function () {
        if ($(this).val() != 0) {
            $("#SaveClosingforSelling").addClass('btnenable')
            $('#SaveClosingforSelling').prop("disabled", false);
        }
        else {
            $("#errorMessageforSellingMLSID").text('')
        }
    });//My Active MLS_Search Key up functionalaity to cleare error msg in add list to Selling Popup
    $("#buyerforselling").keyup(function () {
        if ($(this).val() != 0) {
            $("#SaveClosingforSelling").addClass('btnenable')
            $('#SaveClosingforSelling').prop("disabled", false);
        }
        else {
            $("#errorMessageforSellingMLSID").text('')
        }
    });//Agent Search Key up functionalaity to clear error msg in add list to Selling Popup
    $(function () {
        $("#mlsforbuying").autocomplete({
            source: function (request, response) {
                if (request.term.indexOf('#') > -1)
                    //alert('#')
                    Method = "AgentSearchMLSIDGet?MLSID=";
                else
                    Method = "AgentSearchAddressGet?Address=";
                $.ajax({
                    url: '/Agent/AgentShowings/AddListingBySearch',
                    data: { SearchEle: request.term, Method: Method },
                    dataType: "json",
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {

                        if (data.length <= 0) {
                            $("#errorMessageforMLSID").text('No Listings Found')
                            $("#mlsforbuying").focus();
                        }
                        else {
                            $("#errorMessageforMLSID").text('')
                            response($.map(data, function (item) {
                                return { label: item.MLSNO + "-" + item.ADDRESS, value: item.MLSNO + "-" + item.ADDRESS };
                            }))
                        }
                    },
                    error: function (response) {
                        //alert(response.responseText);
                    },
                    failure: function (response) {
                        //alert(response.responseText);
                    }
                });
            },
            select: function (e, i) {
                //closingMLS_Buying = i.item.value;
                //alert(i.item.value);
            },
            minLength: 2
        });
    });//Auto Complete for MLSID from RETS to add My Active Buyers
    $(function () {
        $("#mymlsforselling").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '/Agent/AgentCloser/SearchMyActiveListings',
                    data: { AgentID: AgentId, SearchEle: request.term },
                    dataType: "json",
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data.length <= 0) {
                            $("#errorMessageforSellingMLSID").text('No Listings Found')
                            $("#mymlsforselling").focus();
                        }
                        else {
                            $("#errorMessageforSellingMLSID").text('')
                            response($.map(data, function (item) {
                                return { label: item.MLSId + "-" + item.ADDRESKKS, value: item.MLSId + "-" + item.ADDRESKKS };
                            }))
                        }
                    },
                    error: function (response) {
                        //alert(response.responseText);
                    },
                    failure: function (response) {
                        //alert(response.responseText);
                    }
                });
            },
            select: function (e, i) {
                //closingMLS_Buying = i.item.value;
                //alert(i.item.value);
            },
            minLength: 2
        });
    });//Auto Complete for MLSID from Agent Active lsitings to add other Agents n Add Selling Popup
    $(function () {
        $("#buyerforselling").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '/Agent/AgentCloser/SearchAgentsForAddListing',
                    data: { AgentID: AgentId, SearchEle: request.term },
                    dataType: "json",
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data.length <= 0) {
                            $("#errorMessageforSellingMLSID").text('No Agent is Found')
                            $("#buyerforselling").focus();
                        }
                        else {
                            $("#errorMessageforSellingMLSID").text('')
                            response($.map(data, function (item) {
                                return { label: item.AgentID + "-" + item.FirstName + " " + item.LastName, value: item.AgentID + "-" + item.FirstName + " " + item.LastName };
                            }))
                        }
                    },
                    error: function (response) {
                        //alert(response.responseText);
                    },
                    failure: function (response) {
                        //alert(response.responseText);
                    }
                });
            },
            select: function (e, i) {
                //closingMLS_Buying = i.item.value;
                //alert(i.item.value);
            },
            minLength: 2
        });
    });//Auto Complete for Agent to be assigned to my acctive listings in Add Selling Popup
    $("#activebuyerpopup2").change(function () {
        if ($(this).val() != 0) {
            $("#SaveClosingforBuyingPopup2").addClass('btnenable')
            $('#SaveClosingforBuyingPopup2').prop("disabled", false);
            $("#errorMessageforbuyerpopup2").text('')
        }
        else {
            $("#SaveClosingforBuyingPopup2").removeClass('btnenable').addClass('btndisble');
            $('#SaveClosingforBuyingPopup2').prop("disabled", true);
            $("#errorMessageforbuyerpopup2").text('Select Buyer')
        }
    });//Event to select Buyer in Buying->Manage->Assign the Buyer to Closing
    $("#SaveClosingforBuying").click(function () {
        // alert($("#mlsforbuying").val().split('-')[0] + " -" + $("#activebuyer").val());
        //alert($(this).attr('id'))

        if ($("#mlsforbuying").val() == "") {
            $("#SaveClosingforBuying").removeClass('btnenable').addClass('btndisble');
            $('#SaveClosingforBuying').prop("disabled", true);
            $("#errorMessageforMLSID").text('Select Listing')
        }
        else {
            $("#SaveClosingforBuying").addClass('btnenable')
            $('#SaveClosingforBuying').prop("disabled", false);
            $("#errorMessageforMLSID").text('')
            $.ajax({
                url: "/Agent/AgentCloser/AddClosingtoBuying",
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                data: { AgetID: AgentId, BuyerId: $("#activebuyer").val(), Mlsid: $("#mlsforbuying").val().split('-')[0] },
                success: function (data) {
                    if (data[0].STATUS == "Closer Added") {
                        //$("#heading").text("Success");
                        //$("#content_text").text("Closer Added Successfully");
                        //$("#AlertPopup").modal("show")
                        getBuyingListings();
                        //alert("Closer Added Successfully")
                    }
                    else if (data[0].STATUS == "Already Exists") {
                        $("#AlertMessagePopup").modal("show")
                    }
                    else {
                        //alert("Warning Message : "+res)
                        $("#heading").text("Alert");
                        $("#content_text").text("Message " + data);
                        $("#AlertPopup").modal("show")
                    }
                    //if (data == "Success") {
                    $("#AddClosingForBuying_Popup").modal('hide');
                    //}
                },
            });
        }

    });//Event to Add Listing to My ACtive Buyer in Buying Tab
    $("#SaveClosingforBuyingPopup2").click(function () {
        if ($("#activebuyerpopup2").val() == "0") {
            $("#SaveClosingforBuyingPopup2").removeClass('btnenable').addClass('btndisble');
            $('#SaveClosingforBuyingPopup2').prop("disabled", true);
            $("#errorMessageforbuyerpopup2").text('Select Buyer')
        }
        else {
            //mlsforbuyingpopup2
            $("#SaveClosingforBuyingPopup2").addClass('btnenable')
            $('#SaveClosingforBuyingPopup2').prop("disabled", false);
            $("#errorMessageforbuyerpopup2").text('')
            $.ajax({
                url: "/Agent/AgentCloser/AddbuyertoClosing",
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                data: { FK_ClosingID: closingPKeyID, BuyerId: $("#activebuyerpopup2").val() },
                success: function (data) {
                    if (data == "Success") {
                        //$("#heading").text("Success");
                        //$("#content_text").text("Buyer Added Successfully");
                        //$("#AlertPopup").modal("show")
                        BuyingListingManage(closingPKeyID, 'Buying')
                    }
                    else {
                        //alert("Warning Message : "+res)
                        $("#heading").text("Alert");
                        $("#content_text").text("Message " + data);
                        $("#AlertPopup").modal("show")
                    }
                    //if (data == "Success") {
                    $("#AddBuyerPopup").modal('hide');
                    //}
                },
            });

        }
    });//Event To Add Buyer from Buyning Manage to the closing which is added to my by other agent
    $("#SaveClosingforSelling").click(function () {
        // alert($("#mlsforbuying").val().split('-')[0] + " -" + $("#activebuyer").val());
        if ($("#buyerforselling").val() == "" && $("#mymlsforselling").val() == "") {
            $("#SaveClosingforSelling").removeClass('btnenable').addClass('btndisble');
            $('#SaveClosingforSelling').prop("disabled", true);
            $("#errorMessageforSellingMLSID").text('Fields are mandatory')
        }
        else {
            $("#SaveClosingforSelling").addClass('btnenable')
            $('#SaveClosingforSelling').prop("disabled", false);
            $("#errorMessageforSellingMLSID").text('')
            $.ajax({
                url: "/Agent/AgentCloser/AddMyListingforSelling",
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                data: { AgetID: AgentId, SellingAgentId: $("#buyerforselling").val().split('-')[0], Mlsid: $("#mymlsforselling").val().split('-')[0], },
                success: function (data) {
                    if (data[0].STATUS == "Closer Added") {
                        //$("#heading").text("Success");
                        //$("#content_text").text("Closer Added Successfully");
                        //$("#AlertPopup").modal("show");
                        getSellingListings();
                    }
                    else if (data[0].STATUS == "Already Exists") {
                        $("#AlertMessagePopup").modal("show")
                    }
                    else {
                        //alert("Warning Message : "+res)
                        $("#heading").text("Alert");
                        $("#content_text").text("Message " + data);
                        $("#AlertPopup").modal("show")
                    }
                    //if (data == "Success") {
                    $("#AddClosingForSelling_Popup").modal('hide');
                    // }
                },
            });
        }

    });//Event to Add Listing to My ACtive Buyer in Buying Tab
    function getSellingListings() {
        $.ajax({
            url: "/Agent/AgentCloser/GetMySellingListings",
            type: "GET",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: { AgentID: AgentId },
            success: function (data) {
                if (data.length > 0) {
                    Bind_selling_litings(data);
                }
                else {
                }
            }
        });
    }//Function to get Closings in Selling Tab
    function Bind_selling_litings(data) {
        $("#sellinglistings_div").empty(data);
        $.each(data, function (i, exp) {
            var imagepin = "", price = "";
            var bedrooms, bathrooms, sqftAcres;
            var BtnPrevImgId = "Prev" + data[i].MLSID;
            var BtnNextImgId = "Next" + data[i].MLSID;
            var PrpImagesArray = []
            var DivImgId = "sellerdiv_" + data[i].MLSID;
            var PhotosURL = [], TotalImages = [];
            PrpImagesArray = [];
            if (data[i].PRP_IMAGES != null && data[i].PRP_IMAGES != "," && data[i].PRP_IMAGES != "") {
                var c = data[i].PHOTO_COUNT;
                PrpImagesArray = data[i].PRP_IMAGES.split(',');
                TotalImages.push(data[i].PRP_IMAGES);
                if (TotalImages.length > 0)
                    PhotosURL = data[i].PRP_IMAGES.split(',');
                else
                    PhotosURL[0] = data[i].PRP_IMAGES;
            }
            else {
                PhotosURL[0] = "/img/NoImage.png";
            }
            if (data[i].Class == "Rental") {
                price = "$ " + (data[i].PRP_PRICE + "").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,") + "/mo";
                //if (data[i].Is_Viewd == "YES")
                //    imagepin = '<img src="/img/viewed_graypin.png" height="20" style="position:relative; top:-2px" />'
                //else
                imagepin = '<img src="/img/gray_legendMenu.png" height="20" style="position:relative; top:-2px" />'
            }
            else {
                price = "$ " + (data[i].PRP_PRICE + "").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
                if (data[i].Status == "Active") {
                    //if (data[i].Is_Viewd == "YES")
                    //    imagepin = '<img src="/img/viewed_greenpin.png" height="20" style="position:relative; top:-2px" />'
                    //else
                    imagepin = '<img src="/img/Green_legend_Menu.png" height="20" style="position:relative; top:-2px" />'
                }
                else if (data[i].Status == "Pending") {
                    //if (data[i].Is_Viewd == "YES")
                    imagepin = '<img src="/img/yellow_legendMenu.png" height="20" style="position:relative; top:-2px;margin-left: -3px;" />'
                    //else
                    //    imagepin = '<img src="/img/viewed_yellowpin.png" height="20" style="position:relative; top:-2px" />'
                }
                else if (data[i].Status == "Sold") {
                    //if (data[i].Is_Viewd == "YES")
                    imagepin = '<img src="/img/red_legendMenu.png" height="20" style="position:relative; top:-2px;margin-left: -3px;" />'
                    //else
                    //    imagepin = '<img src="/img/viewed_yellowpin.png" height="20" style="position:relative; top:-2px" />'
                }
            }

            if (TotalImages.length > 0) {
                var photosdiv = '<div class="col-sm-2" style="height: 110px; position: relative; background-image: url(' + PhotosURL[0] + '); background-size: 100% 100%;" id="' + DivImgId + '">'
                                       + '<div class="col-sm-12" style="margin-top: 13%;padding: 15px;"><a href="#"><img src="/img/SliderBackArrow.png" onclick="return PrpImageSlider(\'' + imgindex + '\',\'' + "-1" + '\',\'' + DivImgId + '\',\'' + PrpImagesArray + '\',\'' + data[i].MLSID + '\')" width="21" height="29" alt="" style="margin-left: -25%;" id="' + BtnPrevImgId + '" hidden="hidden"/></a>'
                                       + '<a href="#"><img src="/img/SliderNextArrow.png" width="21" height="29" onclick="return PrpImageSlider(\'' + imgindex + '\',\'' + "1" + '\',\'' + DivImgId + '\',\'' + PrpImagesArray + '\',\'' + data[i].MLSID + '\')" alt="" style="float: right;margin-right: -24%;" id="' + BtnNextImgId + '"   /></a></div>'
                                       + '</div>';
            }
            else {
                var photosdiv = '<div class="col-sm-2" style="height: 110px; position: relative; background-image: url(' + PhotosURL[0] + '); background-size: 100% 100%;" id="' + DivImgId + '">'
                                       + '<div class="col-sm-12" style="margin-top: 13%;padding: 15px;"><a href="#"><img src="/img/SliderBackArrow.png" onclick="return PrpImageSlider(\'' + imgindex + '\',\'' + "-1" + '\',\'' + DivImgId + '\',\'' + PrpImagesArray + '\',\'' + data[i].MLSID + '\')" width="21" height="29" alt="" style="margin-left: -20%;" id="' + BtnPrevImgId + '" hidden="hidden"/></a>'
                                       + '<a href="#"><img src="/img/SliderNextArrow.png" width="21" height="29" onclick="return PrpImageSlider(\'' + imgindex + '\',\'' + "1" + '\',\'' + DivImgId + '\',\'' + PrpImagesArray + '\',\'' + data[i].MLSID + '\')" alt="" style="float: right;margin-right: -17%;" id="' + BtnNextImgId + '"    hidden="hidden"/></a></div>'
                                       + '</div>';
            }
            var addr11 = data[i].PRP_ADDRESS.split(',')[1];
            var addr12 = (data[i].PRP_ADDRESS.split(',')[2] != undefined) ? "," + data[i].PRP_ADDRESS.split(',')[2] : "";
            var listing = '<div class="col-sm-12" style="padding: 15px;border-bottom: 2px solid #ff5d26;">' + photosdiv
                          + '<div class="col-sm-7" style="border-right: 1px solid lightgray;height: 110px;"><div class="col-sm-12">' + imagepin
                          + '<span id="Rate" style="left:2px;color:#ff5d26;font-size:16px; font-weight:bold; position:relative; ">' + price + '</span></div>'
                          + '<div class="col-sm-12" style="font-weight:bold;font-size:18px;">' + data[i].PRP_ADDRESS.split(',')[0] + '</div>'
                          + '<div class="col-sm-12" style="font-size:14px">' + addr11 + '' + addr12 + '</div>'
                           + '<div class="col-sm-12" style="font-size:14px">MLS#' + data[i].MLSID + '</div></div>'
                           + '<div class="col-sm-3" style="text-align:center;line-height:6"><a href="#" onclick="return BuyingListingManage(\'' + data[i].PK_ClosingID + '\',\'Selling\')" style="font-weight:bold;text-decoration:none;font-size:16px;color:#ff5d26">Manage</a>'
                           + '<img class="sideArrow" style="top:28px;float: right; position: relative;cursor:pointer" src="/img/lit_icon_btn.png" onclick="AgentFullDetailsView(\'' + AgentId + '\', \'' + data[i].MLSID + '\')"></div>'
                          + '</div>';
            $("#sellinglistings_div").append(listing);
        });
    }//Bind closings in Selling Tab
    function BindAssignedMe() {
       // alert($("#assignedtome_Data_Div").html().length)
        if ($("#assignedtome_Data_Div").html().length <= 0) {
            closingpartiesget(closingPKeyID, AgentId, 'Me')
        }
       
    }//function to call Closer parties In Assigned ME tab
    function BindAssignedBuyer() {
        if ($("#assignedtobuyer_Data_Div").html().length <= 0) {
            closingpartiesget(closingPKeyID, $("#sellerbuyer_id").text(), 'Buyer')
        }
    }//function to cal Buyers/Sellers in Assigned Buyer Tab
    function BindAssignedAgent() {
        if ($("#assignedtoagent_Data_Div").html().length <= 0) {
            closingpartiesget(closingPKeyID, $("#listingagent_id").text(), 'Agent')
        }
    }//function to cal Agents Buyer/Seller Agent in Assigned to Listing/Buyer Agent Tab
    function closingpartiesget(closingid, assignedid, tab) {
        $.ajax({
            url: "/Agent/AgentCloser/GetClosingPartiesinManage",
            type: "GET",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: { FK_ClosingID: closingid, AssignedID: assignedid },
            success: function (data) {
                if (data.length > 0) {
                    if (tab == "Me") {
                        a(data);
                    }
                    else if (tab == "Buyer") {
                        b(data);
                    }
                    else if (tab == "Agent") {
                        c(data);
                    }
                }
                else {
                    if (tab == "Me") {
                        $("#assignedtome_Data_Div").empty();
                        $("#assignedtome_Data_Div").append(watemark);
                    }
                    else if (tab == "Buyer") {
                        $("#assignedtobuyer_Data_Div").empty();
                        $("#assignedtobuyer_Data_Div").append(watemark);
                    }
                    else if (tab == "Agent") {
                        $("#assignedtoagent_Data_Div").empty();
                        $("#assignedtoagent_Data_Div").append(watemark);
                    }
                }
            }
        });
    }//get Closer Parties
    function a(data) {
        $("#editClosings").text('Edit')
        $("#assignedtome_Data_Div").empty();
        var tab = $('<div class="collapse" style="background-color: white;" id="AssignedMe"></div>');
        var TableId = "table_1";
        var table = $('<table id=' + TableId + ' style="width:100%;border-bottom: 1px solid #c0bdbd;"></table>');
        $.each(data, function (i, item) {
            var btn = '', photosrc = "";
            if (item.Status == "Not Set") {
                var statusdropdown = '<select disabled="true" style="pointer-events:none !important" data-container="body" class="selectpicker statusselect" id="' + item.PK_CloserPartyID + '" data-index="' + item.PK_CloserPartyID + '"><option value="Not Set">Not set</option>'
                                 + '<option value="Pending">Pending</option><option value="Confirmed">Confirmed</option></select>';
                btn = '<button class="QuitChetOrangeButton" onclick="schedule_edit(\'' + item.PK_CloserPartyID + '\',\'schedule\')" id="btnEditSchedule" style="padding:6px 25px; height:auto !important">Schedule Service</button>'
            }
            else if (item.Status == "Pending") {
                var statusdropdown = '<select data-container="body" class="selectpicker statusselect" id="' + item.PK_CloserPartyID + '" data-index="' + item.PK_CloserPartyID + '">'
                                + '<option value="Pending">Pending</option><option value="Confirmed">Confirmed</option></select>';
                btn = '<button class="QuitChetOrangeButton" onclick="schedule_edit(\'' + item.PK_CloserPartyID + '\',\'editschedule\')" id="btnEditSchedule" style="padding:6px 25px; height:auto !important">Edit Schedule</button>'
            }
            else if (item.Status == "Confirmed") {
                btn = '';
                var statusdropdown = '<select data-container="body" class="selectpicker statusselect" id="' + item.PK_CloserPartyID + '" data-index="' + item.PK_CloserPartyID + '">'
                                + '<option value="Pending">Pending</option><option value="Confirmed">Confirmed</option></select>';
            }
            if (item.CloserImage_Path != "" && item.CloserImage_Path != null && item.CloserImage_Path != "null")
                photosrc = item.CloserImage_Path;
            else
                photosrc = '/img/addphotopic.png';
            var sdate = ((item.ScheduleDate != null) ? item.ScheduleDate : '')
            var stime = ((item.ScheduleTime != null) ? item.ScheduleTime : '')
            var assignedtome = ' <div class="col-sm-12" style="border-bottom:1px solid #ff5d26;height:120px;background-color:#fff"> <div class="col-sm-4" style="height:120px;">'
                         + '<div class="col-sm-12" style="font-size:16px;color:#ff5d26;font-weight:bold;padding: 10px;">' + item.CloserPartyType + '</div>'
                         + '<div class="col-sm-4" style=""><img class="photos2" src="' + photosrc + '" /></div><div class="col-sm-8" style="padding:0;top:5px">'
                         + '<div class="col-sm-12" style="padding:0;font-size:16px;font-weight:bold">' + item.Name + '</div><div class="col-sm-12" style="padding:0">' + item.CompanyName + '</div></div></div>'
                         + '<div class="col-sm-5" style="padding:0;top:20px;height:80px;border-left:1px solid #fe7f55"><div class="col-sm-1"><i class="fa fa-at" style="color:#ff5d26"></i></div>'
                         + '<div class="col-sm-6" style="padding-left:0">' + item.Address + '<br /></div>'
                         + '<div class="col-sm-4" style="padding:0"><a href="#" id="" onclick="showDirections(\'' + item.Address + '\')" class="btn btn-default btn-sm" style="padding:5px;border:1px solid #ff5d26;background-color:transparent;color:#ff5d26;">'
                         + 'Directions&nbsp;&nbsp;<img style="float:right" src="/img/Directions_icon.png" /> </a></div> </div>'
                         + '<div class="col-sm-3" style="text-align:center;padding:17px">' + btn + '</div></div>'
                         + '<div class="col-sm-12" style="padding:5px 0px 5px;background-color:#fff;border-bottom:1px solid #ff5d26"><div class="col-sm-4" style="padding-right:0;line-height:2"><i class="glyphicon glyphicon-calendar" style="color:#ff5d26"></i>&nbsp;&nbsp;' + sdate
                         + '&nbsp;&nbsp;&nbsp;<img style="margin-bottom:0" src="/img/watchh.png" />&nbsp;&nbsp;' + stime + '</div>'
                         + '<div class="col-sm-4" style="">Status:&nbsp;&nbsp;'+statusdropdown+'</div>'
                         + '<div class="col-sm-4" style="display:none"><a href="#" id="" class="btn btn-default btn-mn" style="padding:3px 60px;font-size:13px;border:1px solid #ff5d26;background-color:transparent;color:#ff5d26;">'
                         + 'Export to Calendar</a></div> </div>'
            var trow = $('<tr style="border-bottom: 0.5px solid lightgray"></tr>');
            trow.append('<td style="background-color: #fbaf8c;width: 50px;text-align: center;"><a href="#" onclick="removeCloserParty(' + item.PK_CloserPartyID + ',\'me\')"><img src="/img/removebtn_icon.png" /></span></a></td>');
            trow.append('<td >' + assignedtome + '</td>');
            table.append(trow);
            tab.append(table);
            setTimeout(function () {
                $("#" + item.PK_CloserPartyID).val(item.Status);
                $("#" + item.PK_CloserPartyID).selectpicker('refresh');
            }, 800);
        })
        $("#assignedtome_Data_Div").append(table);
        $("#table_1 tbody tr").find('td:first-child').hide();
        $('.selectpicker').selectpicker('render');
        
       // $("#" + item.PK_CloserPartyID);
    }//Binding Closer parties In Assigned ME tab

    //jQuery('#collaps_divs #assignedtomeDi #assignedtobuyereDiv #assignedtoagenteDiv').click(function (e) {
    //    jQuery('.collapse').collapse('hide');
    //});
    //var $myGroup = $('#collaps_divs');
    //$myGroup.on('show', '.collapse', function () {
    //    $myGroup.find('.collapse.in').collapse('hide');
    //});
    function b(data) {
        $("#editClosings").text('Edit')
        $("#assignedtobuyer_Data_Div").empty();
        var tab = $('<div style="background-color: white;" id="table2"></div>');
        var TableId = "table_2";
        var table = $('<table id=' + TableId + ' style="width:100%;border-bottom: 1px solid #c0bdbd;"></table>');
        $.each(data, function (i, item) {
            var btn2 = '';
            if (item.Status == "Not Set" || item.Status == "Pending")
                btn2 = '<div class="btn-group" style="width:100%"><button type="button" class="btn btn-primary" style="background-color:#EFEFEF;border:none;color:black;width:40%;text-align: left;">Status:</button>'
                           + '<button type="button" style="background-color:#FF7926;border:none;width:60%" class="btn btn-primary"><div class="orangetail"></div><i class="fa fa-check fa-1" aria-hidden="true" style="float:left;margin-top:3px"></i>Pending</button></div>';
            else if (item.Status == "Confirmed")
                btn2 = '<div class="btn-group" style="width:100%"><button type="button" class="btn btn-primary" style="background-color:#EFEFEF;border:none;color:black;width:40%;text-align: left;">Status:</button>'
                               + '<button type="button" style="background-color:#43B75A;border:none;width:60%" class="btn btn-primary"><div class="greentail"></div>'
                               + '<img src="/img/checkmar_savedPopup.png" style="margin-bottom:0;float:left;">Confirmed</button></div>';
            //<i class="fa fa-check fa-1" aria-hidden="true" style="float:left;margin-top:3px"></i>
            if (item.CloserImage_Path != "" && item.CloserImage_Path != null && item.CloserImage_Path != "null")
                photosrc = item.CloserImage_Path;
            else
                photosrc = '/img/NoImage.png';
            var sdate2 = ((item.ScheduleDate != null) ? item.ScheduleDate : '')
            var stime2 = ((item.ScheduleTime != null) ? item.ScheduleTime : '')
            var assignedtobuyer = ' <div class="col-sm-12" style="border-bottom:1px solid #ff5d26;height:120px;background-color:#fff"> <div class="col-sm-4" style="height:120px;">'
                               + '<div class="col-sm-12" style="font-size:16px;color:#ff5d26;font-weight:bold;padding: 10px;">' + item.CloserPartyType + '</div>'
                               + '<div class="col-sm-4" style=""><img class="photos2" src="' + photosrc + '" /></div><div class="col-sm-8" style="padding:0;top:5px">'
                               + '<div class="col-sm-12" style="padding:0;font-size:16px;font-weight:bold">' + item.Name + '</div><div class="col-sm-12" style="padding:0">' + item.CompanyName + '</div></div></div>'
                               + '<div class="col-sm-5" style="padding:0;top:20px;height:80px;border-left:1px solid #fe7f55"><div class="col-sm-1"><i class="fa fa-at" style="color:#ff5d26"></i></div>'
                               + '<div class="col-sm-6" style="padding-left:0">' + item.Address + '<br /></div>'
                               + '<div class="col-sm-4" style="padding:0"><a href="#" id="" onclick="showDirections(\'' + item.Address + '\')" class="btn btn-default btn-sm" style="padding:5px;border:1px solid #ff5d26;background-color:transparent;color:#ff5d26;">'
                               + 'Directions&nbsp;&nbsp;<img style="float:right" src="/img/Directions_icon.png" /> </a></div> </div>'
                               + '<div class="col-sm-3" style="text-align:center;padding:0;top:18px;">'
                               + btn2 + '</div>'
                               + '</div>'
                               + '<div class="col-sm-12" style="padding:5px 0px 5px;background-color:#FFF6F2;border-bottom:1px solid #ff5d26"><div class="col-sm-4" style="border-right:1px solid #ff5d26;padding-right:0;line-height:2"><i class="glyphicon glyphicon-calendar" style="color:#ff5d26"></i>&nbsp;&nbsp;' + sdate2
                               + '&nbsp;&nbsp;&nbsp;<img style="margin-bottom:0" src="/img/watchh.png" />&nbsp;&nbsp;'+stime2+'</div>'
                               //+ '<div class="col-sm-4" style="">Status:&nbsp;&nbsp;<select class="selectpicker" id="status"><option>Not set</option><option>Pending</option><option>Confirmed</option></select></div>'
                               + '<div class="col-sm-4" style="display:none"><a href="#" id="" class="btn btn-default btn-mn" style="padding:3px 60px;font-size:13px;border:1px solid #ff5d26;background-color:transparent;color:#ff5d26;">'
                               + 'Export to Calendar</a></div> </div>';
            var trow = $('<tr style="border-bottom: 0.5px solid lightgray"></tr>');
            trow.append('<td style="background-color: #fbaf8c;width: 50px;text-align: center;"><a href="#" onclick="removeCloserParty(' + item.PK_CloserPartyID + ',\'buyerseller\')"><img src="/img/removebtn_icon.png" /></span></a></td>');
            trow.append('<td >' + assignedtobuyer + '</td>');
            table.append(trow);
            tab.append(table);
        });
        $("#assignedtobuyer_Data_Div").append(table);
        $("#table_2 tbody tr").find('td:first-child').hide();
        // $("#assignedtobuyer_Data_Div").append(assignedtobuyer);
    }//Binding Buyers/Sellers in Assigned Buyer Tab
    function c(data) {
        $("#editClosings").text('Edit')
        $("#assignedtoagent_Data_Div").empty();
        var tab = $('<div style="background-color: white;" id="table3"></div>');
        var TableId = "table_3";
        var table = $('<table id=' + TableId + ' style="width:100%;border-bottom: 1px solid #c0bdbd;"></table>');
        $.each(data, function (i, item) {
            if (item.Status == "Not Set" || item.Status == "Pending")
                btn3 = '<div class="btn-group" style="width:100%"><button type="button" class="btn btn-primary" style="background-color:#EFEFEF;border:none;color:black;width:40%;text-align: left;">Status:</button>'
                           + '<button type="button" style="background-color:#FF7926;border:none;width:60%" class="btn btn-primary"><div class="orangetail"></div>'
                           +'<img src="/img/checkmar_savedPopup.png" style="margin-bottom:0;float:left;">Pending</button></div>';
            //<i class="fa fa-check fa-1" aria-hidden="true" style="float:left;margin-top:3px"></i>
            else if (item.Status == "Confirmed")
                btn3 = '<div class="btn-group" style="width:100%"><button type="button" class="btn btn-primary" style="background-color:#EFEFEF;border:none;color:black;width:40%;text-align: left;">Status:</button>'
                               + '<button type="button" style="background-color:#43B75A;border:none;width:60%" class="btn btn-primary"><div class="greentail"></div><i class="fa fa-check fa-1" aria-hidden="true" style="float:left;margin-top:3px"></i>Confirmed</button></div>';
            if (item.CloserImage_Path != "" && item.CloserImage_Path != null && item.CloserImage_Path != "null")
                photosrc = item.CloserImage_Path;
            else
                photosrc = '/img/NoImage.png';
            var sdate3 = ((item.ScheduleDate != null) ? item.ScheduleDate : '')
            var stime3 = ((item.ScheduleTime != null) ? item.ScheduleTime : '')
            var assignedtoagent = ' <div class="col-sm-12" style="border-bottom:1px solid #ff5d26;height:120px;background-color:#fff"> <div class="col-sm-4" style="height:120px;">'
                               + '<div class="col-sm-12" style="font-size:16px;color:#ff5d26;font-weight:bold;padding: 10px;">' + item.CloserPartyType + '</div>'
                               + '<div class="col-sm-4" style=""><img class="photos2" src="' + photosrc + '" /></div><div class="col-sm-8" style="padding:0;top:5px">'
                               + '<div class="col-sm-12" style="padding:0;font-size:16px;font-weight:bold">' + item.Name + '</div><div class="col-sm-12" style="padding:0">' + item.CompanyName + '</div></div></div>'
                               + '<div class="col-sm-5" style="padding:0;top:20px;height:80px;border-left:1px solid #fe7f55"><div class="col-sm-1"><i class="fa fa-at" style="color:#ff5d26"></i></div>'
                               + '<div class="col-sm-6" style="padding-left:0">' + item.Address + '<br /></div>'
                               + '<div class="col-sm-4" style="padding:0"><a href="#" id="" onclick="showDirections(\'' + item.Address + '\')" class="btn btn-default btn-sm" style="padding:5px;border:1px solid #ff5d26;background-color:transparent;color:#ff5d26;">'
                               + 'Directions&nbsp;&nbsp;<img style="float:right" src="/img/Directions_icon.png" /> </a></div> </div>'
                               + '<div class="col-sm-3" style="text-align:center;padding:0;top:18px;">'
                               + btn3 + '</div>'
                               + '</div>'
                               + '<div class="col-sm-12" style="padding:5px 0px 5px;background-color:#FFF6F2;border-bottom:1px solid #ff5d26"><div class="col-sm-4" style="border-right:1px solid #ff5d26;padding-right:0;line-height:2"><i class="glyphicon glyphicon-calendar" style="color:#ff5d26"></i>&nbsp;&nbsp;' + sdate3
                               + '&nbsp;&nbsp;&nbsp;<img style="margin-bottom:0" src="/img/watchh.png" />&nbsp;&nbsp;'+stime3+'</div>'
                               //+ '<div class="col-sm-4" style="">Status:&nbsp;&nbsp;<select class="selectpicker" id="status"><option>Not set</option><option>Pending</option><option>Confirmed</option></select></div>'
                               + '<div class="col-sm-4" style="display:none"><a href="#" id="" class="btn btn-default btn-mn" style="padding:3px 60px;font-size:13px;border:1px solid #ff5d26;background-color:transparent;color:#ff5d26;">'
                               + 'Export to Calendar</a></div> </div>';
            var trow = $('<tr style="border-bottom: 0.5px solid lightgray"></tr>');
            trow.append('<td style="background-color: #fbaf8c;width: 50px;text-align: center;"><a href="#" onclick="removeCloserParty(' + item.PK_CloserPartyID + ',\'agent\')"><img src="/img/removebtn_icon.png" /></span></a></td>');
            trow.append('<td >' + assignedtoagent + '</td>');
            table.append(trow);
            tab.append(table);
        });
        $("#assignedtoagent_Data_Div").append(table);
        $("#table_3 tbody tr").find('td:first-child').hide();
    }//Binding Agents Buyer/Seller Agent in Assigned to Listing/Buyer Agent Tab
    function schedule_edit(closingpartyid, action) {
        closingpartyID=closingpartyid;
        if (action == "schedule") {
            $("#shceduleheadertext").text('Schedule Services');
            $("#manageDiv").hide();
            $("#ScheduleAndEditDiv").show();
            $("#schedulediv").show();
            $("#msgdiv").show();
            $("#editschedulediv").hide();
        }
        else if (action == "editschedule") {
            $("#shceduleheadertext").text('Edit Schedule');
            $("#manageDiv").hide();
            $("#ScheduleAndEditDiv").show();
            $("#schedulediv").show();
            $("#msgdiv").hide();
            $("#attachmentdiv").hide();
            $("#editschedulediv").hide();
        }
        var whos = '';
        if (usertypeid == "1") {
            whos = "Customer";
        }
        else if (usertypeid == "2") {
            whos = "Agent";
        }
        $.ajax({
            url: "/Agent/AgentCloser/GetClosingListCloserPartyDetailsMessage",
            type: "GET",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: { FK_CloserPartyID: closingpartyid, UserID: userid, Whos: whos },
            success: function (data) {
                if (data.length > 0) {
                    message = data[0].MESSAGE;
                    if (data[0].CloserImage_Path != "" && data[0].CloserImage_Path != null)
                        $("#cp_photo").attr('src', data[0].CloserImage_Path);
                    else
                        $("#cp_photo").attr('src', '/img/addphotopic.png');
                    $("#cp_name").text(data[0].Name);
                    $("#cp_company").text(data[0].CompanyName);
                    $("#msg").html(data[0].MESSAGE.replace("##TIME##","Any"));
                    if (data[0].AssignedID != "" && data[0].AssignedID != null) {
                        $("#assigneddiv").show();
                        if (data[0].AssignedImage != "" && data[0].AssignedImage != null) {
                            //$("#sellerbuyer_photo").attr('src', data[0].AssignedImage);
                            $("#assinged_photo").attr('src', data[0].AssignedImage);
                        }
                        else
                            $("#assinged_photo").attr('src', '/img/addphotopic.png');
                        $("#assinged_name").text(data[0].AssignedFirstName + " " + data[0].AssignedLastName);
                        if (data[0].Closing_TypeID == "1")
                            $("#assinged_type").text("Buyer");
                        else
                            $("#assinged_type").text("Seller");
                        //For show Call Popup
                        $("#name").text(data[0].AssignedFirstName + " " + data[0].AssignedLastName)
                        $("#phonenumber").text(data[0].AssignedMobileNo);
                    }
                    else {
                        $("#assigneddiv").hide();
                    }
                    $("#clr_addr1").text(data[0].PRP_ADDRESS.split(',')[0]);
                    $("#clr_addr2").text(data[0].PRP_ADDRESS.split(',')[1] + ", " + data[0].PRP_ADDRESS.split(',')[2]);
                    $("#clr_mlsno").text(data[0].MLSID);
                  
                    if (data[0].PRP_IMAGES != '' && data[0].PRP_IMAGES != null && data[0].PRP_IMAGES != "null") {
                        if (data[0].PRP_IMAGES.indexOf(',') > -1) {
                            $('#clr_photo').css('backgroundImage', 'url(' + data[0].PRP_IMAGES.split(',')[0] + ')');
                        }
                        else {
                             $('#clr_photo').css('backgroundImage', 'url(' + data[0].PRP_IMAGES + ')');
                        }
                    }
                    else {
                        $('#clr_photo').css('backgroundImage', 'url("/img/NoImage.png")');
                    }
                    //if (data[0].PHOTO_COUNT > 0) {
                    //    $('#clr_photo').css('backgroundImage', 'url(' + data[0].PRP_IMAGES.split(',')[0] + ')');
                    //}
                    //For chat creation
                    $("#sellerbuyer_id").text(data[0].AssignedID);
                    //$("#sellerbuyer_name").text(data[0].AssignedFirstName + " " + data[0].AssignedLastName);
                    if (action == "editschedule") {
                        //repdate = "17/01/2018";
                       // reptime = data[0].ScheduleTime;
                        $("#S_Service_Date").val(data[0].ScheduleDate);
                        $("#S_Service_Time").val(data[0].ScheduleTime);
                    }
                    else {
                        $("#S_Service_Date").val('');
                        $("#S_Service_Time").val('');
                        repdate = "##DATE##", reptime = "##TIME##";
                    }
                }
            },
        });
        //alert(closingid)
    }//Schedule and Edit Schedule Button Function
    $("#editClosings").click(function () {
        if ($("#editClosings").text() == "Edit") {
            $("#editClosings").text('Save')
            $("#table_1 tbody tr").find('td:first-child').show();
            $("#table_2 tbody tr").find('td:first-child').show();
            $("#table_3 tbody tr").find('td:first-child').show();
        }
        else {
            $("#editClosings").text('Edit')
            $("#table_1 tbody tr").find('td:first-child').hide();
            $("#table_2 tbody tr").find('td:first-child').hide();
            $("#table_3 tbody tr").find('td:first-child').hide();
        }

    })//Edit Closer Parties Button Event
    $("#backBtninScheduleDiv,#CancelSchedule").click(function () {
        $("#manageDiv").show();
        $("#ScheduleAndEditDiv").hide();
        $("#schedulediv").hide();
        $("#editschedulediv").hide();
       //jQuery('.collapse').collapse('hide');
    });//Back to manage From SChedule 
    var removingcloserpartyid = "",selectedtab="";
    function removeCloserParty(closerpartyid, tab) {
        //alert(selectedtab)
        selectedtab = tab;
        removingcloserpartyid = closerpartyid;
        //alert(closerpartyid)
        $("#RemoveClosingPopup").modal('show');
    }//function to get Closerparty Id to remove
    $("#RemoveCloserPartyYesBtn").click(function () {
        //alert(removingcloserpartyid)
        $.ajax({
            url: "/Agent/AgentCloser/RemoveCloserParty",
            type: "GET",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: {PK_CloserPartyID: removingcloserpartyid
            },
            success: function (data) {
                if (data == "Success") {
                    $("#table_1 tbody tr").find('td:first-child').hide();
                    $("#table_2 tbody tr").find('td:first-child').hide();
                    $("#table_3 tbody tr").find('td:first-child').hide();
                    if (selectedtab == "me") {
                        $("#assignedtome_Data_Div").empty();
                        BindAssignedMe()
                    }
                    else if (selectedtab == "buyerseller") {
                        $("#assignedtobuyer_Data_Div").empty();
                       
                        BindAssignedBuyer()
                    }
                    else if (selectedtab == "agent") {
                        $("#assignedtoagent_Data_Div").empty();
                        BindAssignedAgent()
                    }
                }
                    $("#RemoveClosingPopup").modal('hide');
            }
        });
    });//Removeing Closer party by confirmation from Popup
 
    //$("#UpdateScheduleBtn,#SaveScheduleService").click(function () {
        //$("#MessageSentPopup").modal('show');
        //$("#manageDiv").show();
        //$("#ScheduleAndEditDiv").hide();
        //$("#schedulediv").hide();
        //$("#editschedulediv").hide();
    //})//New Schedule and Update Schedule Button Events
    $('#CommentsforCancelledClosingPopup').on('shown.bs.modal', function () {
        $("#errorMessageforClosingComments").hide();
        $("#closingcomments").val('');
    });//Clear Comments when Comments popup opened
    $("#AddCommentsBtn").click(function () {
        //alert(closingPKeyID+","+closingType)
        if ($("#closingcomments").val() != "") {
            $("#errorMessageforClosingComments").hide();
            $.ajax({
                url: "/Agent/AgentCloser/CancelClosing",
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                data: { AgentID: AgentId, PK_ClosingID: closingPKeyID, CancelComment: $("#closingcomments").val() },
                success: function (data) {
                    if (data.length > 0) {
                        if (data == "Success") {
                            $("#manageDiv").hide();
                            $("#tabmenu").show();
                            $("#CommentsforCancelledClosingPopup").modal('hide');
                            if (closingType == "Buying") {

                                $("#buying_tab_a")[0].click();
                            }
                            else if (closingType == "Selling") {
                                $("#selling_tab_a")[0].click();
                            }
                        }
                        else {
                        }
                    }
                    else {
                    }
                }
            });
        }
        else {
            $("#errorMessageforClosingComments").show();
        }
    })//Submit Comments Event
    $(document).on('change', ".statusselect", function (e) {
        e.stopImmediatePropagation();
        //alert(this.value +"--"+$(this).attr("id"));
        $.ajax({
            url: "/Agent/AgentCloser/UpdateCloserListingStatus",
            type: "GET",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: { PK_CloserPartyID: $(this).attr("id"), Status: this.value },
            success: function (data) {
                if (data == "Success") {
                    BuyingListingManage(closingPKeyID, closingType)
                }
                else {

                }
            },
        });
    });//event to Update Status of Closing Assigned to Me
    $("#SaveScheduleService").click(function () {
        var scheduleobj = [closingpartyID, $("#S_Service_Date").val(), $("#S_Service_Time").val(), $("#msg").val(),'']
        //alert(o.join('-'))
        $.ajax({
            url: "/Agent/AgentCloser/SaveScheduleforClosingParty",
            type: "POST",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(scheduleobj),
            success: function (data) {
                if (data == "Success") {
                    $("#assignedtome_Data_Div").empty()
                    $("#closerpartyname").text( $("#cp_name").text());
                    $("#MessageSentPopup").modal('show');
                    $("#manageDiv").show();
                    $("#ScheduleAndEditDiv").hide();
                    $("#schedulediv").hide();
                    $("#editschedulediv").hide();
                    jQuery('.collapse').collapse('hide');
                    //closingpartiesget(closingPKeyID, $("#sellerbuyer_id").text(), tab);
                }
                else {
                    alert('failed')
                }
            },
            error: function (data) {
                alert(data)
            }
        });
    })//Save New Schedule and Update Schedule Button Events
    function showDirections(addr) {
        var street = "https://www.google.com/maps/dir/?api=1&destination=" + addr + "&travelmode=drving";
        window.open(street, '_blank');
    }//Function to get Directions to Listing from your location
</script>
@*//Time Picker Script*@
<script>
    var PrevID = ""; var unavailableDates = [];
    function OpenTimepicker(id, id2) {
        $(document).mouseup(function (e) {
            var container = $("#S_TimePicker");
            // if the target of the click isn't the container nor a descendant of the container
            if (!container.is(e.target) && container.has(e.target).length === 0) {
                container.removeClass('collaspe in');
            }
        });
        if (PrevID != "") {
            $('#' + PrevID).empty();
        }
        var timepickerhtml = "<div class='col-sm-12' style='background-color: white; border-radius:7px;padding:5px 0px 3px 0px;z-index:1048'><div class='col-sm-4'><div><i class='glyphicon glyphicon-menu-up' aria-hidden='true' style='font-size:12px; font-weight:bold;color:#ff6a00' id='HoursUp'></i></div><div><span id='Hours' style='color:black'></span></div><div><i class='glyphicon glyphicon-menu-down' aria-hidden='true' style='font-size:12px; font-weight:bold;color:#ff6a00' id='HoursDown'></i></div></div><div class='col-sm-4' style='padding-left:10px'><div><i class='glyphicon glyphicon-menu-up' aria-hidden='true' style='font-size:12px; font-weight:bold;color:#ff6a00' id='MinUp'></i></div><div><span id='Minutes'  style='color:black'></span></div><div><i class='glyphicon glyphicon-menu-down' aria-hidden='true' style='font-size:12px; font-weight:bold;color:#ff6a00' id='MinDown'></i></div></div><div class='col-sm-4' style='padding-left:5px'><div><i class='glyphicon glyphicon-menu-up' aria-hidden='true' style='font-size:12px; font-weight:bold;color:#ff6a00' id='AP_UP'></i></div><div style='text-align:center'><span id='AM_PM' style='font-size:10px;color:black;font-weight:bold'></span></div><div><i class='glyphicon glyphicon-menu-down' aria-hidden='true' style='font-size:12px; font-weight:bold;color:#ff6a00' id='AP_Down'></i></div></div></div>";
        $('#' + id).html(timepickerhtml);
        // TimePickerEvents();
        PrevID = id;
        $('#Hours').html(hours);
        if ($('#Hours').html().length == 1) {
            $('#Hours').html('0' + $('#Hours').html());
        }
        $('#Minutes').html(minutes);
        if ($('#Minutes').html().length == 1) {
            $('#Minutes').html('0' + $('#Minutes').html());
        }
        $('#AM_PM').html(ampm);
        TimePickerEvents(id2);
    }
    var date = new Date();
    var hours = '12';
    var minutes = '0';
    var ampm = 'PM';
    //hours = date.getHours();
    //minutes = date.getMinutes();
    ampm = hours >= 12 ? 'PM' : 'AM';
    //hours = hours % 12;
    hours = hours < 10 ? '0' + hours : hours; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0' + minutes : minutes;
    $('#S_TimePicker').val(hours + ':' + minutes + ' ' + ampm);
    //$('#S_TimePicker').val("00:00 AM");
    function TimePickerEvents(TPID) {
        //----------AM UP Change functionality
        $('#AP_UP,#AP_Down').click(function () {
            var String = $('#AM_PM').html();
            if ($('#AM_PM').html() == 'PM') {
                $('#AM_PM').html('AM');
            }
            else {
                $('#AM_PM').html('PM');
            }
        })
        ///------Minutes Management
        $('#MinUp').click(function () {
            if (parseInt($('#Minutes').html()) > 0) {
                var Min = parseInt($('#Minutes').html()) - 1;
                $('#Minutes').html(Min);
            }
            else {
                var Min = 59;
                $('#Minutes').html(Min);
            }
            if ($('#Minutes').html().length == 1) {
                $('#Minutes').html('0' + $('#Minutes').html());
            }
        })
        $('#MinDown').click(function () {
            if (parseInt($('#Minutes').html()) < 59) {
                var Min = parseInt($('#Minutes').html()) + 1;
                $('#Minutes').html(Min);
            }
            else {
                var Min = 00;
                $('#Minutes').html(Min);
            }

            if ($('#Minutes').html().length == 1) {
                $('#Minutes').html('0' + $('#Minutes').html());
            }
        })
        //-----Hours Management-------
        $('#HoursUp').click(function () {
            if (parseInt($('#Hours').html()) > 1) {
                var Hours = parseInt($('#Hours').html()) - 1;
                $('#Hours').html(Hours);
            }
            else {
                var Hours = 12;
                $('#Hours').html(Hours);
            }
            if ($('#Hours').html().length == 1) {
                $('#Hours').html('0' + $('#Hours').html());
            }
        })
        $('#HoursDown').click(function () {
            if (parseInt($('#Hours').html()) < 12) {
                var Hours = parseInt($('#Hours').html()) + 1;
                $('#Hours').html(Hours);
            }
            else {
                var Hours = 01;
                $('#Hours').html(Hours);
            }
            if ($('#Hours').html().length == 1) {
                $('#Hours').html('0' + $('#Hours').html());
            }
        })
        $('#HoursUp,#HoursDown,#MinUp,#MinDown,#AP_UP,#AP_Down').click(function () {
            $('#' + TPID).val();
            var Time = $('#Hours').html() + ':' + $('#Minutes').html() + ' ' + $('#AM_PM').html();
            $('#' + TPID).val(Time);
            message = message.replace(reptime, Time);
            $("#msg").html(message);
            reptime = Time;
        })
    }
    ///////////////////////////////////////////
</script>